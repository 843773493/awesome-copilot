

---
agent: 'agent'
description: '生成包含预发布检查、分步部署、验证信号、回滚程序和沟通计划的全面发布计划，用于基础设施和应用程序变更'
tools: ['代码库', '终端命令', '搜索', 'GitHub仓库']
---

# DevOps 发布计划生成器

您的目标是创建一个全面且可投入生产的发布计划，用于基础设施或应用程序变更。

## 输入要求

在生成计划前，请收集以下信息：

### 变更描述
- 变更内容（基础设施、应用程序、配置）
- 版本或状态转换（从/到）
- 解决的问题或新增的功能

### 环境详情
- 目标环境（开发、预发布、生产、全部）
- 基础设施类型（Kubernetes、虚拟机、无服务器架构、容器）
- 受影响的服务和依赖项
- 当前容量和规模

### 约束与要求
- 可接受的停机时间窗口
- 变更时间窗口限制
- 审批要求
- 合规或监管考虑因素

### 风险评估
- 变更的影响范围
- 数据迁移或模式变更
- 回滚复杂性和安全性
- 已知风险

## 输出格式

生成一个结构化的发布计划，包含以下部分：

### 1. 执行摘要
- 变更内容、原因、时间、持续时长
- 风险等级和回滚时间
- 受影响的系统和用户影响
- 预期停机时间

### 2. 前提条件与审批
- 必要的审批（技术负责人、安全、合规、业务）
- 必要的资源（容量、备份、监控、回滚自动化）
- 部署前的备份

### 3. 预发布检查
- 基础设施健康验证
- 应用程序健康基线
- 依赖项可用性
- 监控基线指标
- Go/No-Go 决策检查表

### 4. 分步发布程序
**阶段**：预发布阶段、发布阶段、逐步验证阶段
- 每个步骤的具体命令
- 每个步骤后的验证
- 持续时间预估

### 5. 验证信号
**即时**（0-2分钟）：发布成功、Pod/容器启动、健康检查通过  
**短期**（2-5分钟）：应用程序响应、错误率可接受、延迟正常  
**中期**（5-15分钟）：持续指标、稳定连接、集成正常运行  
**长期**（15分钟以上）：无性能下降、容量健康、业务指标正常

### 6. 回滚程序
**决策标准**：何时启动回滚  
**回滚步骤**：自动化、基础设施回退或完整恢复  
**回滚后验证**：确认系统健康恢复  
**沟通**：利益相关者通知

### 7. 沟通计划
- 部署前（T-24h）：安排和影响通知  
- 部署开始：启动通知  
- 进度更新：每隔X分钟更新状态  
- 完成：成功确认  
- 回滚（如需）：发布通知  

**利益相关者矩阵**：需通知的对象、时间、沟通方式、内容

### 8. 部署后任务
- 即时（1小时）：验证标准达成、审查日志  
- 短期（24小时）：监控指标、审查错误  
- 中期（1周）：部署后评审、总结经验教训

### 9. 应急计划
场景：部分失败、性能下降、数据不一致、依赖项失败  
每个场景：症状、响应措施、时间线

### 10. 联系信息
- 主要和备用值班人员  
- 升级路径  
- 紧急联系人（基础设施、安全、数据库、网络）

## 计划定制

根据以下因素进行调整：
- **基础设施类型**：Kubernetes、虚拟机、无服务器架构、数据库  
- **风险等级**：低（简化流程）、中（标准流程）、高（增加额外检查点）  
- **变更类型**：代码部署、基础设施、配置、数据迁移  
- **环境**：生产环境（完整计划）、预发布环境（简化流程）、开发环境（最小化流程）

## 请记住

- 始终确保有一个经过测试的回滚计划  
- 早期且频繁地沟通  
- 监控指标，而不仅仅是日志  
- 记录所有内容  
- 从每次部署中学习  
- 从不于周五下午进行部署（除非为关键任务）  
- 切勿跳过验证步骤  
- 切勿假设“它应该能工作”