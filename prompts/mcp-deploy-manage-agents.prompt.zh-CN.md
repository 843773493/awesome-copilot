

````prompt
---
mode: 'agent'
tools: ['changes', 'search/codebase', 'edit/editFiles', 'problems']
description: '在 Microsoft 365 管理中心部署和管理基于 MCP 的声明式代理，实现治理、分配和组织级分发'
model: 'gpt-4.1'
tags: [mcp, m365-copilot, 部署, 管理, 代理管理, 治理]
---

# 部署和管理基于 MCP 的代理

使用 Microsoft 365 管理中心部署、管理和治理基于 MCP 的声明式代理，实现组织级分发和控制。

## 代理类型

### 由组织发布
- 使用预定义的指令和操作
- 遵循结构化逻辑以执行可预测的任务
- 需要管理员审批和发布流程
- 支持合规性和治理需求

### 由创建者共享
- 在 Microsoft 365 Copilot Studio 或 Agent Builder 中创建
- 直接与特定用户共享
- 通过搜索、操作、连接器和 API 提升功能
- 在代理注册表中对管理员可见

### Microsoft 代理
- 由 Microsoft 开发和维护
- 与 Microsoft 365 服务集成
- 已预批准并可直接使用

### 外部合作伙伴代理
- 由经过验证的外部开发者/供应商创建
- 需要管理员审批和控制
- 可配置可用性和权限

### 前沿代理
- 具有实验性或高级功能
- 可能需要有限的发布或额外的监管
- 示例：
  - **应用构建代理**：通过 M365 Copilot 或 Power Platform 管理中心进行管理
  - **工作流代理**：通过 Power Platform 管理中心管理流程自动化

## 管理员角色和权限

### 必要角色
- **AI 管理员**：具备完整的代理管理功能
- **全局读者**：仅限查看（不可编辑）

### 最佳实践
- 使用权限最小的权限角色
- 仅在紧急情况下使用全局管理员
- 遵循最小特权原则

## Microsoft 365 管理中心中的代理管理

### 访问代理管理
1. 访问 [Microsoft 365 管理中心](https://admin.microsoft.com/)
2. 导航至 **代理** 页面
3. 查看可用、已部署或被阻止的代理

### 可用操作

**查看代理**
- 按可用性筛选（可用、已部署、被阻止）
- 搜索特定代理
- 查看代理详情（名称、创建者、日期、主机产品、状态）

**部署代理**
分发选项：
1. **代理商店**：提交至 Partner Center 进行验证和公开可用
2. **组织部署**：IT 管理员将代理部署至所有员工或特定员工

**管理代理生命周期**
- **发布**：使代理对组织可用
- **部署**：分配给特定用户或用户组
- **阻止**：防止代理被使用
- **删除**：从组织中删除代理

**配置访问**
- 为特定用户组设置可用性
- 按代理管理权限
- 控制哪些代理出现在 Copilot 中

## 部署工作流

### 发布至组织

**对于代理开发者：**
1. 使用 Microsoft 365 代理工具包构建代理
2. 在开发环境中彻底测试
3. 提交代理以供审批
4. 等待管理员审核

**对于管理员：**
1. 在管理中心审核提交的代理
2. 验证合规性和安全性
3. 批准用于组织
4. 配置部署设置
5. 发布至选定用户或组织范围

### 通过代理商店部署

**开发者步骤：**
1. 完成代理开发和测试
2. 将代理打包以供提交
3. 提交至 Partner Center
4. 等待验证流程
5. 接收审批通知
6. 代理出现在 Copilot 商店中

**管理员步骤：**
1. 在 Copilot 商店中发现代理
2. 审核代理详情和权限
3. 分配给组织或用户组
4. 监控使用情况和反馈

### 部署组织代理

**管理员部署选项：**
```
组织范围：
- 所有拥有 Copilot 许可证的员工
- 自动在 Copilot 中可用

基于组：
- 特定部门或团队
- 安全组分配
- 基于角色的访问控制
```

**配置步骤：**
1. 在管理中心导航至代理页面
2. 选择要部署的代理
3. 选择部署范围：
   - 所有用户
   - 特定安全组
   - 单个用户
4. 设置可用性状态
5. 如适用，配置权限
6. 部署并监控

## 用户体验

### 代理发现
用户可通过以下方式找到代理：
- Microsoft 365 Copilot 中心
- Copilot 界面中的代理选择器
- 组织的代理目录

### 代理访问控制
用户可以：
- 在交互过程中切换代理的开关
- 在自己的体验中添加或删除代理
- 右键点击代理以管理偏好
- 仅访问管理员允许的代理

### 代理使用
- 代理出现在 Copilot 侧边栏
- 用户选择代理以设定上下文
- 查询通过选定代理进行路由
- 响应利用代理的功能

## 治理和合规性

### 安全考虑
- **数据访问**：审查代理可访问的数据
- **API 权限**：验证所需的作用域
- **身份验证**：确保安全的 OAuth 流程
- **外部连接**：评估外部集成的风险

### 合规性要求
- **数据驻留**：确认数据保留在边界内
- **隐私政策**：审查代理的隐私声明
- **使用条款**：验证可接受的使用政策
- **审计日志**：监控代理的使用和活动

### 监控和报告
跟踪：
- 代理采用率
- 用户反馈和满意度
- 错误率和性能
- 安全事件或违规

## MCP 特定管理

### MCP 代理特性
- 通过 Model Context Protocol 连接到外部系统
- 使用 MCP 服务器暴露的工具
- 需要 OAuth 2.0 或 SSO 身份验证
- 支持与 REST API 代理相同的治理

### MCP 代理验证
验证：
- MCP 服务器 URL 是否可访问
- 身份验证配置是否安全
- 导入的工具是否合适
- 响应数据是否不暴露敏感信息
- 服务器是否遵循安全最佳实践

### MCP 代理部署
与 REST API 代理相同的流程：
1. 在管理中心进行审核
2. 验证 MCP 服务器的合规性
3. 测试身份验证流程
4. 部署至用户或用户组
5. 监控性能

## 代理设置和配置

### 组织设置
在租户级别进行配置：
- 启用或禁用代理创建
- 设置默认权限
- 配置审批工作流
- 定义合规性策略

### 每个代理设置
为单个代理进行配置：
- 可用性（开启/关闭）
- 用户分配（所有用户/特定组/个人）
- 权限作用域
- 使用限制或配额

### 环境路由
对于基于 Power Platform 的代理：
- 配置默认环境
- 为 Copilot Studio 启用环境路由
- 通过 Power Platform 管理中心管理流程

## 共享代理管理

### 查看共享代理
管理员可以看到：
- 所有共享代理的列表
- 创建者信息
- 创建日期
- 主机产品
- 可用性状态

### 管理共享代理
管理员操作：
- 搜索特定的共享代理
- 查看代理功能
- 阻止不安全或不合规的代理
- 监控代理生命周期

### 用户对共享代理的访问
用户通过以下方式访问：
- Microsoft 365 Copilot 在不同界面
- 代理特定的任务和协助
- 创建者定义的功能

## 最佳实践

### 部署前
- **小范围试点测试**：在小用户组中进行测试
- **收集早期采用者反馈**：获取用户意见
- **验证安全性和合规性**：确保符合要求
- **记录代理功能和限制**：详细说明代理的能力和限制
- **对用户进行代理使用培训**：指导用户如何使用代理

### 部署期间
- **分阶段发布**：管理采用过程
- **监控性能和错误**：实时跟踪
- **持续收集反馈**：保持沟通
- **及时解决问题**：快速响应
- **向用户传达可用性**：通知用户代理已发布

### 部署后
- **跟踪指标**：采用率、满意度、错误率
- **迭代改进**：根据反馈优化
- **更新**：保持代理与新功能同步
- **淘汰**：移除过时或未使用的代理
- **审查**：定期进行安全和合规性审计

### 沟通
- 向用户宣布新代理
- 提供文档和示例
- 分享最佳实践和用例
- 突出代理的优势和功能
- 提供支持渠道

## 故障排除

### 代理未显示
- 在管理中心检查部署状态
- 确认用户是否在分配的组中
- 确认代理是否被阻止
- 检查用户是否拥有 Copilot 许可证
- 刷新 Copilot 界面

### 身份验证失败
- 验证 OAuth 凭据是否有效
- 检查用户是否拥有必要的权限
- 确认 MCP 服务器是否可访问
- 独立测试身份验证流程

### 性能问题
- 监控 MCP 服务器响应时间
- 检查网络连接
- 在管理中心查看错误日志
- 验证代理是否被限制访问频率

### 合规性违规
- 如果代理不安全，立即阻止
- 审查审计日志以查找违规
- 调查数据访问模式
- 更新策略以防止再次发生

## 资源

- [Microsoft 365 管理中心](https://admin.microsoft.com/)
- [Power Platform 管理中心](https://admin.powerplatform.microsoft.com/)
- [Partner Center](https://partner.microsoft.com/) 用于代理提交
- [Microsoft Agent 365 概述](https://learn.microsoft.com/en-us/microsoft-agent-365/overview)
- [代理注册表文档](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/agent-registry)

## 工作流

询问用户：
1. 该代理是否已准备好部署，还是仍在开发中？
2. 谁应该有访问权限（所有用户、特定组、个人）？
3. 是否有需要处理的合规性或安全性要求？
4. 应该发布到组织还是公共商店？
5. 需要哪些监控和报告？

然后提供：
- 分步部署指南
- 管理中心配置步骤
- 用户分配建议
- 合规性和治理检查清单
- 监控和报告计划

````