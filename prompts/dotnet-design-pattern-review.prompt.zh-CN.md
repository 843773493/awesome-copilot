

---
agent: 'agent'
description: '审查 C#/.NET 代码中的设计模式实现，并提出改进建议。'
---
# .NET/C# 设计模式审查

审查 ${selection} 中的 C#/.NET 代码，评估其设计模式的实现情况，并为解决方案/项目提出改进建议。请勿修改代码，仅提供审查意见。

## 必须实现的设计模式

- **命令模式**：泛型基类 (`CommandHandler<TOptions>`), `ICommandHandler<TOptions>` 接口, `CommandHandlerOptions` 继承, 静态 `SetupCommand(IHost host)` 方法
- **工厂模式**：复杂对象创建服务提供者集成
- **依赖注入**：主构造函数语法, `ArgumentNullException` 空值检查, 接口抽象, 合适的服务生命周期
- **仓储模式**：异步数据访问接口，提供数据库连接抽象
- **提供者模式**：外部服务抽象（数据库、AI），清晰的契约定义，配置处理
- **资源模式**：ResourceManager 用于本地化消息，独立的 .resx 文件（LogMessages, ErrorMessages）

## 审查清单

- **设计模式**：识别使用的设计模式。命令处理程序、工厂、提供者和仓储模式是否正确实现？是否有遗漏的有益模式？
- **架构**：是否遵循命名空间规范 (`{Core|Console|App|Service}.{Feature}`)？核心/控制台项目之间是否有适当的分离？是否模块化且易于阅读？
- **.NET 最佳实践**：主构造函数，使用 Task 返回的 async/await，ResourceManager 的使用，结构化日志记录，强类型配置？
- **GoF 模式**：命令、工厂、模板方法、策略模式是否正确实现？
- **SOLID 原则**：是否存在单一职责、开闭原则、里氏替换、接口隔离、依赖倒置原则的违反？
- **性能**：是否正确使用 async/await，资源释放是否合理，是否使用 ConfigureAwait(false)，是否有并行处理的机会？
- **可维护性**：职责分离是否明确，错误处理是否一致，配置使用是否恰当？
- **可测试性**：依赖项是否通过接口抽象，是否包含可模拟的组件，异步测试性是否良好，是否兼容 AAA 模式？
- **安全性**：是否进行输入验证，安全凭证处理是否得当，是否使用参数化查询，异常处理是否安全？
- **文档**：公共 API 是否有 XML 文档，参数/返回值描述是否清晰，资源文件组织是否合理？
- **代码清晰度**：名称是否反映领域概念，通过设计模式明确意图，结构是否自解释？
- **整洁代码**：编码风格是否一致，方法/类大小是否合适，复杂度是否最小化，是否消除了重复代码？

## 改进建议重点

- **命令处理程序**：基类验证，一致的错误处理，正确的资源管理
- **工厂**：依赖配置，服务提供者集成，资源释放模式
- **提供者**：连接管理，异步模式，异常处理和日志记录
- **配置**：数据注解，验证属性，安全处理敏感值
- **AI/ML 集成**：语义内核模式，结构化输出处理，模型配置

请提供与项目架构和 .NET 最佳实践相一致的具体、可操作的改进建议。