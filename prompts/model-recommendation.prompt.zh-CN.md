

---
描述: "分析聊天模式或提示文件，根据任务复杂度、所需功能和成本效益推荐最佳AI模型"
代理: "代理"
工具:
  - "search/codebase"
  - "fetch"
  - "context7/*"
模型: 自动选择 (copilot)
---

# GitHub Copilot聊天模式与提示文件的AI模型推荐

## 任务目标

分析`.agent.md`或`.prompt.md`文件以理解其目的、复杂度和所需功能，然后从GitHub Copilot可用的选项中推荐最合适的AI模型。根据任务特性、模型优势、成本效益和性能权衡提供推荐理由。

## 范围与前提条件

- **输入**: `.agent.md`或`.prompt.md`文件的路径
- **可用模型**: GPT-4.1, GPT-5, GPT-5 mini, GPT-5 Codex, Claude Sonnet 3.5, Claude Sonnet 4, Claude Sonnet 4.5, Claude Opus 4.1, Gemini 2.5 Pro, Gemini 2.0 Flash（已弃用）, Grok Code Fast 1, o3, o4-mini（含弃用日期）
- **模型自动选择**: 可在VS Code（2025年9月+）中使用，从GPT-4.1, GPT-5 mini, GPT-5, Claude Sonnet 3.5/4.5（排除溢价乘数>1的模型）
- **上下文**: GitHub Copilot订阅层级（免费：2000次完成 + 每月50次聊天，仅限0x模型；专业：无限次0x + 每月1000次专业；专业+：无限次0x + 每月5000次专业）

## 输入

必填项:

- `${input:filePath:Path to .agent.md or .prompt.md file}` - 分析文件的绝对路径或工作区相对路径

可选项:

- `${input:subscriptionTier:Pro}` - 用户的Copilot订阅层级（免费, 专业, 专业+）- 默认为专业

## 工作流程

### 1. 文件分析阶段

**读取与解析文件**:

- 读取目标`.agent.md`或`.prompt.md`文件
- 提取前缀信息（描述, 模式, 工具, 指定模型）
- 分析正文内容以识别:
  - 任务复杂度（简单/中等/复杂/高级）
  - 所需推理深度（基础/中级/高级/专家）
  - 代码生成需求（最小/中等/大量）
  - 多轮对话需求
  - 上下文窗口需求（小/中/大/非常大）
  - 专业能力需求（图像分析, 长上下文, 实时数据）

**任务类型分类**:

根据内容分析确定主要任务类别:

1. **简单重复任务**:

   - 模式: 格式化, 简单重构, 添加注释/文档字符串, 基础CRUD
   - 特征: 逻辑直接, 上下文需求低, 优先快速响应
   - 关键词: format, comment, simple, basic, add docstring, rename, move

2. **代码生成与实现**:

   - 模式: 编写函数/类, 实现功能, API端点, 测试
   - 特征: 中等复杂度, 领域知识, 代码风格
   - 关键词: implement, create, generate, write, build, scaffold

3. **复杂重构与架构**:

   - 模式: 系统设计, 架构审查, 大规模重构, 性能优化
   - 特征: 深层推理, 多组件, 权衡分析
   - 关键词: architect, refactor, optimize, design, scale, review architecture

4. **调试与问题解决**:

   - 模式: 修复错误, 错误分析, 系统性排查, 根因分析
   - 特征: 分步推理, 调试上下文, 验证需求
   - 关键词: debug, fix, troubleshoot, diagnose, error, investigate

5. **规划与研究**:

   - 模式: 功能规划, 研究, 文档分析, ADR创建
   - 特征: 只读, 上下文收集, 决策支持
   - 关键词: plan, research, analyze, investigate, document, assess

6. **代码审查与质量分析**:

   - 模式: 安全性分析, 性能审查, 最佳实践验证, 合规性检查
   - 特征: 批判性思维, 模式识别, 领域专业知识
   - 关键词: review, analyze, security, performance, compliance, validate

7. **专业领域任务**:

   - 模式: Django/框架特定, 可访问性（WCAG）, 测试（TDD）, API设计
   - 特征: 深层领域知识, 框架规范, 标准合规
   - 关键词: django, accessibility, wcag, rest, api, testing, tdd

8. **高级推理与多步骤工作流**:
   - 模式: 算法优化, 复杂数据转换, 多阶段工作流
   - 特征: 高级推理, 数学/算法思维, 顺序逻辑
   - 关键词: algorithm, optimize, transform, sequential, reasoning, calculate

**提取能力需求**:

基于前缀信息中的`工具`和正文指令:

- **只读工具**（search, fetch, usages, githubRepo）: 适合低复杂度、快速响应的模型
- **写操作**（edit/editFiles, new）: 需要中等复杂度，准确性重要
- **执行工具**（runCommands, runTests, runTasks）: 需要验证，采用迭代方法
- **高级工具**（context7/\*, sequential-thinking/\*）: 需要复杂推理，推荐使用专业模型
- **多模态**（图像分析引用）: 需要支持图像的模型

### 2. 模型评估阶段

**应用模型选择标准**:

对每个可用模型进行评估，基于以下维度:

#### 模型能力矩阵

| 模型                   | 乘数 | 速度    | 代码质量 | 推理能力 | 上下文容量 | 视觉支持 | 最适合场景                                          |
| ----------------------- | ---- | ------- | -------- | -------- | ---------- | -------- | ---------------------------------------------------- |
| GPT-4.1                 | 0x   | 快速     | 良好      | 良好      | 128K       | ✅       | 通用任务平衡，所有计划均包含此模型                   |
| GPT-5 mini              | 0x   | 最快     | 良好      | 基础      | 128K       | ❌       | 简单任务，快速响应，成本效益高                      |
| GPT-5                   | 1x   | 中等     | 卓越      | 高级      | 128K       | ✅       | 复杂代码，高级推理，多轮对话                         |
| GPT-5 Codex             | 1x   | 快速     | 卓越      | 良好      | 128K       | ❌       | 代码优化，重构，算法任务                             |
| Claude Sonnet 3.5       | 1x   | 中等     | 卓越      | 卓越      | 200K       | ✅       | 代码生成，长上下文，推理平衡                         |
| Claude Sonnet 4         | 1x   | 中等     | 卓越      | 高级      | 200K       | ❌       | 复杂代码，稳健推理，企业级任务                       |
| Claude Sonnet 4.5       | 1x   | 中等     | 卓越      | 专家      | 200K       | ✅       | 高级代码，架构，设计模式                             |
| Claude Opus 4.1         | 10x  | 慢       | 优秀      | 专家      | 1M         | ✅       | 大型代码库，架构审查，研究                           |
| Gemini 2.5 Pro          | 1x   | 中等     | 卓越      | 高级      | 2M         | ✅       | 非常长上下文，多模态，实时数据                       |
| Gemini 2.0 Flash（已弃用） | 0.25x | 最快     | 良好      | 良好      | 1M         | ❌       | 快速响应，成本效益高（已弃用）                       |
| Grok Code Fast 1        | 0.25x | 最快     | 良好      | 基础      | 128K       | ❌       | 速度关键的简单任务，预览功能（免费）                  |
| o3（已弃用）            | 1x   | 慢       | 良好      | 专家      | 128K       | ❌       | 高级推理，算法优化                                    |
| o4-mini（已弃用）       | 0.33x | 快速     | 良好      | 良好      | 128K       | ❌       | 低成本推理（已弃用）                                  |

#### 选择决策树

```
开始
  │
  ├─ 任务复杂度?
  │   ├─ 简单/重复 → GPT-5 mini, Grok Code Fast 1, GPT-4.1
  │   ├─ 中等 → GPT-4.1, Claude Sonnet 4, GPT-5
  │   └─ 复杂/高级 → Claude Sonnet 4.5, GPT-5, Gemini 2.5 Pro, Claude Opus 4.1
  │
  ├─ 推理深度?
  │   ├─ 基础 → GPT-5 mini, Grok Code Fast 1
  │   ├─ 中级 → GPT-4.1, Claude Sonnet 4
  │   ├─ 高级 → GPT-5, Claude Sonnet 4.5
  │   └─ 专家 → Claude Opus 4.1, o3（已弃用）
  │
  ├─ 是否涉及代码?
  │   ├─ 是 → GPT-5 Codex, Claude Sonnet 4.5, GPT-5
  │   └─ 否 → GPT-5, Claude Sonnet 4
  │
  ├─ 上下文大小?
  │   ├─ 小（<50K token）→ 任何模型
  │   ├─ 中等（50-200K）→ Claude模型, GPT-5, Gemini
  │   ├─ 大（200K-1M）→ Gemini 2.5 Pro, Claude Opus 4.1
  │   └─ 非常大（>1M）→ Gemini 2.5 Pro（2M）, Claude Opus 4.1（1M）
  │
  ├─ 是否需要视觉支持?
  │   ├─ 是 → GPT-4.1, GPT-5, Claude Sonnet 3.5/4.5, Gemini 2.5 Pro, Claude Opus 4.1
  │   └─ 否 → 所有模型
  │
  ├─ 成本敏感度?（基于订阅层级）
  │   ├─ 免费层级 → 仅限0x乘数模型: GPT-4.1, GPT-5 mini, Grok Code Fast 1
  │   ├─ 专业层级（每月1000次专业）→ 优先使用0x，谨慎使用1x，避免10x
  │   └─ 专业+层级（每月5000次专业）→ 1x模型自由使用，10x用于关键任务
  │
  └─ 优先级因素?
      ├─ 速度 → GPT-5 mini, Grok Code Fast 1, Gemini 2.0 Flash
      ├─ 成本 → 0x模型（GPT-4.1, GPT-5 mini）或较低乘数（0.25x, 0.33x）
      ├─ 质量 → Claude Sonnet 4.5, GPT-5, Claude Opus 4.1
      └─ 平衡 → GPT-4.1, Claude Sonnet 4, GPT-5
```

### 3. 推荐生成阶段

**主要推荐**:

- 根据任务分析和决策树确定最佳模型
- 提供与文件内容特征直接关联的详细理由
- 解释乘数成本对用户订阅层级的影响

**替代推荐**:

- 推荐1-2个替代模型并解释权衡
- 包含替代模型可能更优的场景
- 考虑优先级因素的覆盖（速度 vs. 质量 vs. 成本）

**自动选择指导**:

- 评估任务是否适合自动模型选择（排除乘数>1的高级模型）
- 解释何时手动选择模型优于让Copilot自动选择
- 注意特定任务中自动选择的限制

**弃用警告**:

- 如果文件当前使用已弃用模型（o3, o4-mini, Claude Sonnet 3.7, Gemini 2.0 Flash）则标记
- 提供迁移路径到推荐的替代模型
- 包含弃用时间线（例如："o3弃用日期：2025-10-23"）

**前缀信息更新指导**:

如果文件未指定`model`字段：

```markdown
## 推荐：添加模型指定

当前前缀信息:
\`\`\`yaml

---

描述: "..."
工具: [...]

---

\`\`\`

推荐前缀信息:
\`\`\`yaml

---

描述: "..."
模型: "[推荐模型名称]"
工具: [...]

---

\`\`\`

理由: [解释为何此模型最适合该任务]
```

如果文件已指定模型：

```markdown
## 当前模型评估

指定模型: `[当前模型]`（乘数: [X]x）

推荐: [保持当前模型 | 考虑切换至[推荐模型]]

理由: [解释]
```

**工具兼容性验证**:

验证指定工具与推荐模型的兼容性:

- 如果工具包含`context7/*`或`sequential-thinking/*`：推荐高级推理模型（Claude Sonnet 4.5, GPT-5, Claude Opus 4.1）
- 如果工具涉及视觉相关引用：确保模型支持图像（如果选择GPT-5 Codex, Claude Sonnet 4或mini模型则需标记）
- 如果工具为只读（search, fetch）：建议成本效益高的模型（GPT-5 mini, Grok Code Fast 1）

### 4. Context7集成以获取最新信息

**利用Context7获取模型文档信息**:

当对当前模型能力存在疑问时，使用Context7获取最新信息:

```markdown
**通过Context7验证**:

使用`context7/get-library-docs`并指定库ID`/websites/github_en_copilot`:

- 查询主题: "[模型名称]代码生成质量能力"
- 获取当前模型特性、乘数、弃用状态
- 与分析文件需求进行交叉验证
```

**示例Context7使用**:

```
如果不确定Claude Sonnet 4.5是否支持图像分析：
→ 使用Context7查询主题"Claude Sonnet 4.5视觉图像多模态支持"
→ 确认功能支持后再推荐用于多模态任务
```

## 输出质量标准

### 报告结构

生成包含以下部分的结构化Markdown报告:

```markdown
# AI模型推荐报告

**分析文件**: `[文件路径]`
**文件类型**: [聊天模式 | 提示]
**分析日期**: [YYYY-MM-DD]
**订阅层级**: [免费 | 专业 | 专业+]

---

## 文件摘要

**描述**: [从前缀信息提取]
**模式**: [ask | edit | agent]
**工具**: [工具列表]
**当前模型**: [指定模型或"未指定"]

## 任务分析

### 任务复杂度

- **级别**: [简单 | 中等 | 复杂 | 高级]
- **推理深度**: [基础 | 中级 | 高级 | 专家]
- **上下文需求**: [小 | 中 | 大 | 非常大]
- **代码生成**: [最小 | 中等 | 大量]
- **多模态**: [是 | 否]

### 任务类别

[从工作流程阶段1的8个类别中识别的主要类别]

### 关键特征

- 特征1: [解释]
- 特征2: [解释]
- 特征3: [解释]

## 模型推荐

### 🏆 主要推荐: [模型名称]

**乘数**: [X]x ([订阅层级的成本影响])
**优势**:

- 优势1: [与任务相关的具体优势]
- 优势2: [与任务相关的具体优势]
- 优势3: [与任务相关的具体优势]

**理由**:
[将任务特征与模型能力连接的详细解释]

**成本影响**（针对[订阅层级]）:

- 每次请求乘数: [X]x
- 预估使用量: [基于任务频率的粗略估计]
- [其他成本信息]

### 🔄 替代选项

#### 选项1: [模型名称]

- **乘数**: [X]x
- **适用场景**: [具体场景]
- **权衡**: [与主要推荐的对比]

#### 选项2: [模型名称]

- **乘数**: [X]x
- **适用场景**: [具体场景]
- **权衡**: [与主要推荐的对比]

### 📊 本任务的模型对比

| 标准         | [主要模型] | [替代选项1] | [替代选项2] |
|--------------|-----------|------------|------------|
| 任务匹配度   | ⭐⭐⭐⭐⭐   | ⭐⭐⭐       | ⭐⭐⭐       |
| 代码质量     | [评分]    | [评分]     | [评分]     |
| 推理能力     | [评分]    | [评分]     | [评分]     |
| 速度         | [评分]    | [评分]     | [评分]     |
| 成本效益     | [评分]    | [评分]     | [评分]     |
| 上下文容量   | [容量]    | [容量]     | [容量]     |
| 视觉支持     | [是/否]   | [是/否]    | [是/否]    |
```

## 质量保障

### 验证步骤

- [ ] 文件成功读取并解析
- [ ] 正确提取前缀信息（或标记缺失）
- [ ] 准确分类任务复杂度（简单/中等/复杂/高级）
- [ ] 从8个选项中识别主要任务类别
- [ ] 模型推荐与决策树逻辑一致
- [ ] 解释推荐模型对用户订阅层级的乘数成本
- [ ] 提供替代模型并明确权衡说明
- [ ] 包含自动选择指导（推荐/不推荐/特定场景）
- [ ] 包含弃用模型警告（如适用）
- [ ] 提供可直接复制粘贴的前缀信息更新示例（有效YAML）
- [ ] 验证工具兼容性（模型能力与指定工具匹配）
- [ ] 在需要时使用Context7获取最新模型信息

### 成功标准

- 推荐基于文件特征具体说明
- 成本影响清晰且适合订阅层级
- 替代模型覆盖不同优先级因素（速度 vs. 质量 vs. 成本）
- 前缀信息更新示例可直接使用（无占位符）
- 用户可立即采取行动（明确步骤）
- 报告结构清晰，易于阅读（良好的结构、表格、表情符号标记）

### 失败触发条件

- 文件路径无效或无法读取 → 停止并请求有效路径
- 文件类型不是`.agent.md`或`.prompt.md` → 停止并澄清文件类型
- 无法从内容中确定任务复杂度 → 请求更具体的文件或澄清
- 模型推荐与文档记录的模型能力矛盾 → 使用Context7验证最新信息
- 订阅层级无效（非免费/专业/专业+）→ 默认为专业并注明假设

## 高级用例

### 分析多个文件

如果用户提供多个文件:

1. 逐个分析文件
2. 为每个文件生成单独推荐
3. 提供推荐对比汇总表
4. 标注任何模式（例如："所有调试相关模式受益于Claude Sonnet 4.5"）

### 对比分析

如果用户询问"对于此文件，X和Y模型哪个更好？":

1. 仅对比这两个模型
2. 使用并排表格格式
3. 声明胜者并具体说明理由
4. 包含订阅层级的成本对比

### 迁移规划

如果文件指定了已弃用模型:

1. 在报告中优先提供迁移指导
2. 测试当前行为与替代模型能力的差异
3. 如果预期重大变更则提供分阶段迁移
4. 包含回滚计划（如需）

## 示例

### 示例1：简单格式化任务

**文件**: `format-code.prompt.md`
**内容**: "使用Black风格格式化Python代码，添加类型提示"
**推荐**: GPT-5 mini（0x乘数，最快，适合重复格式化）
**替代**: Grok Code Fast 1（0.25x，更快但上下文较少）
**理由**: 任务简单且重复；无需高级推理；优先速度

### 示例2：复杂架构审查

**文件**: `architect.agent.md`
**内容**: "审查系统设计以实现可扩展性、安全性和可维护性；分析权衡；提供ADR级别建议"
**推荐**: Claude Sonnet 4.5（1x乘数，专家推理，适合架构）
**替代**: Claude Opus 4.1（10x，用于代码库>500K token的非常大任务）
**理由**: 需要深层推理，架构专业知识，设计模式；Sonnet 4.5在此方面表现优异

### 示例3：Django专家模式

**文件**: `django.agent.md`
**内容**: "使用Django 5.x专家模式，优化ORM，异步视图，REST API设计；使用context7获取最新Django文档"
**推荐**: GPT-5（1x乘数，高级推理，代码质量优秀）
**替代**: Claude Sonnet 4.5（1x，替代视角，框架能力强）
**理由**: 领域专业知识 + context7集成受益于高级推理；1x成本适用于专家模式

### 示例4：免费层级用户与规划模式

**文件**: `plan.agent.md`
**内容**: "使用只读工具（search, fetch, githubRepo）进行研究和规划模式"
**订阅层级**: 免费（2000次完成 + 每月50次聊天，仅限0x模型）
**推荐**: GPT-4.1（0x，平衡，包含在免费层级）
**替代**: GPT-5 mini（0x，更快但上下文较少）
**理由**: 免费层级仅限0x模型；GPT-4.1为规划任务提供最佳质量与上下文平衡

## 知识库

### 模型乘数成本参考

| 乘数 | 含义                                          | 免费层级 | 专业使用 | 专业+使用 |
|------|-----------------------------------------------|----------|----------|----------|
| 0x   | 所有计划均包含，无计费                          | ✅       | 无限次   | 无限次   |
| 0.25x | 4次请求=1次专业请求                             | ❌       | 4000次   | 20000次  |
| 0.33x | 3次请求=1次专业请求                             | ❌       | 3000次   | 15000次  |
| 1x   | 1次请求=1次专业请求                             | ❌       | 1000次   | 5000次   |
| 1.25x | 1次请求=1.25次专业请求                          | ❌       | 800次    | 4000次   |
| 10x  | 1次请求=10次专业请求（非常昂贵）                | ❌       | 100次    | 500次    |

### 模型变更日志与弃用（2025年10月）

**弃用模型**（2025-10-23生效）:

- ❌ o3（1x）→ 替换为GPT-5或Claude Sonnet 4.5进行推理
- ❌ o4-mini（0.33x）→ 替换为GPT-5 mini（0x）以降低成本，GPT-5（1x）以提高质量
- ❌ Claude Sonnet 3.7（1x）→ 替换为Claude Sonnet 4或4.5
- ❌ Claude Sonnet 3.7 Thinking（1.25x）→ 替换为Claude Sonnet 4.5
- ❌ Gemini 2.0 Flash（0.25x）→ 替换为Grok Code Fast 1（0.25x）或GPT-5 mini（0x）

**预览模型**（可能变更）:

- 🧪 Claude Sonnet 4.5（1x）- 预览状态，可能有API变更
- 🧪 Grok Code Fast 1（0.25x）- 预览，预览期间免费

**稳定生产模型**:

- ✅ GPT-4.1, GPT-5, GPT-5 mini, GPT-5 Codex（OpenAI）
- ✅ Claude Sonnet 3.5, Claude Sonnet 4, Claude Opus 4.1（Anthropic）
- ✅ Gemini 2.5 Pro（Google）

### 自动模型选择行为（2025年9月+）

**包含在自动选择中**:

- GPT-4.1（0x）
- GPT-5 mini（0x）
- GPT-5（1x）
- Claude Sonnet 3.5（1x）
- Claude Sonnet 4.5（1x）

**排除在自动选择中**:

- 乘数>1的模型（Claude Opus 4.1, 已弃用的o3）
- 被管理员策略阻止的模型
- 订阅计划中不可用的模型（免费层级中的1x模型）

**当自动选择时**:

- Copilot分析提示复杂度、上下文大小和任务类型
- 从可用池中选择，基于可用性和速率限制
- 自动选择模型应用10%的乘数折扣
- 在聊天视图中悬停时显示所选模型

## Context7查询模板

在需要验证时使用以下查询模式:

**模型能力**:

```
主题: "[模型名称]代码生成质量能力"
库: /websites/github_en_copilot
```

**模型乘数**:

```
主题: "[模型名称]请求乘数成本计费"
库: /websites/github_en_copilot
```

**弃用状态**:

```
主题: "2025年10月弃用模型时间线"
库: /websites/github_en_copilot
```

**视觉支持**:

```
主题: "[模型名称]图像视觉多模态支持"
库: /websites/github_en_copilot
```

**自动选择**:

```
主题: "自动模型选择行为可选模型"
库: /websites/github_en_copilot
```

---

**最后更新**: 2025-10-28
**模型数据更新至**: 2025年10月
**弃用截止日期**: o3, o4-mini, Claude Sonnet 3.7变体, Gemini 2.0 Flash的弃用日期为2025-10-23