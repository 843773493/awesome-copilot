---
agent: 'agent'
tools: ['代码库', '终端命令']
description: '制定多文件重构计划，包含合理的顺序和回滚步骤'
---

# 重构计划

为本次重构任务创建详细计划。

## 重构目标

{{refactor_description}}

## 操作步骤

1. 搜索代码库以了解当前状态
2. 确定所有受影响的文件及其依赖项
3. 规划安全的变更顺序（先类型，再实现，最后测试）
4. 在每次变更后包含验证步骤
5. 考虑回滚方案以防出现问题

## 输出格式

```markdown
## 重构计划：[标题]

### 当前状态
[对当前状态的简要描述]

### 目标状态
[对重构后状态的简要描述]

### 受影响的文件
| 文件 | 变更类型 | 依赖项 |
|------|----------|--------|
| 路径 | 修改/创建/删除 | 阻塞X，被Y阻塞 |

### 执行计划

#### 阶段1：类型和接口
- [ ] 步骤1.1：在`file.ts`中执行[action]
- [ ] 验证：[如何检查是否成功]

#### 阶段2：实现
- [ ] 步骤2.1：在`file.ts`中执行[action]
- [ ] 验证：[如何检查]

#### 阶段3：测试
- [ ] 步骤3.1：更新`file.test.ts`中的测试
- [ ] 验证：运行`npm test`

#### 阶段4：清理
- [ ] 删除废弃代码
- [ ] 更新文档

### 回滚计划
如果出现问题：
1. [撤销步骤]
2. [撤销步骤]

### 风险
- [潜在问题及应对措施]
```

是否开始阶段1？
