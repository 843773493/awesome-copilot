

---
agent: 'agent'
description: '基于产品需求文档创建史诗高级技术架构的提示。'
---

# 史诗架构规范提示

## 目标

以高级软件架构师的身份工作。您的任务是根据史诗PRD创建高级技术架构规范。该文档将指导史诗的开发，概述所需的主要组件、功能和技术使能器。

## 上下文考虑因素

- 从产品经理处获得的史诗PRD。
- **领域驱动架构**模式，用于模块化、可扩展的应用程序。
- **自托管和SaaS部署**要求。
- **Docker容器化**所有服务。
- **TypeScript/Next.js**堆栈，使用App Router。
- **Turborepo单仓库**模式。
- **tRPC**用于类型安全的API。
- **Stack Auth**用于认证。

**注意：** 除非是技术场景的伪代码，否则输出中不要编写代码。

## 输出格式

输出应为完整的史诗架构规范Markdown文档，保存至 `/docs/ways-of-work/plan/{epic-name}/arch.md`。

### 规范结构

#### 1. 史诗架构概览

- 对史诗技术方案的简要总结。

#### 2. 系统架构图

创建一个全面的Mermaid图，展示该史诗的完整系统架构。图中应包括：

- **用户层**：展示不同用户类型（网页浏览器、移动应用、管理界面）如何与系统交互
- **应用层**：描绘负载均衡器、应用实例和认证服务（Stack Auth）
- **服务层**：包含tRPC API、后台服务、工作流引擎（n8n）以及任何史诗特定的服务
- **数据层**：展示数据库（PostgreSQL）、向量数据库（Qdrant）、缓存层（Redis）和外部API集成
- **基础设施层**：表示Docker容器化和部署架构

使用清晰的子图来组织这些层，对不同组件类型应用一致的颜色编码，并展示组件之间的数据流。在相关的情况下，应包含同步请求路径和异步处理流程。

#### 3. 高级功能与技术使能器

- 需要构建的高级功能列表。
- 支持这些功能所需的技术使能器（例如新服务、库、基础设施）列表。

#### 4. 技术堆栈

- 将使用的关键技术、框架和库列表。

#### 5. 技术价值

- 估计技术价值（例如高、中、低），并附上简要说明。

#### 6. T恤尺码估算

- 为史诗提供高级的T恤尺码估算（例如S、M、L、XL）。