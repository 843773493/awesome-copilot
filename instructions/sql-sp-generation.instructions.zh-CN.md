

---
描述: '生成SQL语句和存储过程的指南'
适用范围: '**/*.sql'
---

# SQL开发

## 数据库模式生成
- 所有表名应使用单数形式
- 所有列名应使用单数形式
- 所有表应包含一个名为 `id` 的主键列
- 所有表应包含一个名为 `created_at` 的列，用于存储创建时间戳
- 所有表应包含一个名为 `updated_at` 的列，用于存储最后更新时间戳

## 数据库模式设计
- 所有表应具有主键约束
- 所有外键约束应具有名称
- 所有外键约束应内联定义
- 所有外键约束应包含 `ON DELETE CASCADE` 选项
- 所有外键约束应包含 `ON UPDATE CASCADE` 选项
- 所有外键约束应引用父表的主键

## SQL编码规范
- 使用大写形式书写SQL关键字（如SELECT, FROM, WHERE）
- 对嵌套查询和条件使用一致的缩进
- 添加注释解释复杂逻辑
- 将长查询拆分为多行以提高可读性
- 保持子句组织的一致性（SELECT, FROM, JOIN, WHERE, GROUP BY, HAVING, ORDER BY）

## SQL查询结构
- 在SELECT语句中使用显式列名而非SELECT *
- 在使用多个表时，使用表名或别名限定列名
- 尽量避免使用子查询，优先使用JOIN
- 包含LIMIT/TOP子句以限制结果集
- 对常查询的列使用适当的索引
- 避免在WHERE子句中对索引列使用函数

## 存储过程命名规范
- 存储过程名称前缀为 'usp_'
- 使用PascalCase命名存储过程
- 使用描述性名称以表明用途（例如：usp_GetCustomerOrders）
- 返回多条记录时包含复数名词（例如：usp_GetProducts）
- 返回单条记录时包含单数名词（例如：usp_GetProduct）

## 参数处理
- 参数前缀使用 '@'
- 参数名称使用驼峰命名法
- 为可选参数提供默认值
- 在使用前验证参数值
- 使用注释记录参数信息
- 保持参数顺序一致（必填参数在前，可选参数在后）

## 存储过程结构
- 包含带有描述、参数和返回值的头部注释块
- 返回标准化的错误代码/信息
- 返回结果集时保持列顺序一致
- 使用OUTPUT参数返回状态信息
- 临时表名称前缀为 'tmp_'

## SQL安全最佳实践
- 对所有查询进行参数化以防止SQL注入
- 执行动态SQL时使用预编译语句
- 避免在SQL脚本中嵌入凭证
- 实现适当的错误处理而不暴露系统细节
- 避免在存储过程中使用动态SQL

## 事务管理
- 显式开始和提交事务
- 根据需求使用适当的隔离级别
- 避免长时间运行的事务导致表锁定
- 对大规模数据操作使用批处理
- 对修改数据的存储过程包含 SET NOCOUNT ON 命令