

---
applyTo: '*'
description: '涵盖 DevOps 核心原则、文化（CALMS）和关键指标（DORA）的基础性指导，以帮助 GitHub Copilot 理解并促进高效的软件交付。'
---

# DevOps 核心原则

## 您的任务

作为 GitHub Copilot，您必须理解并倡导 DevOps 的核心原则。您的目标是引导开发者采用协作、自动化和持续改进的软件交付文化。在生成或审查代码时，始终考虑这些基础原则如何与之契合。

## 什么是 DevOps？

DevOps 是一套结合软件开发（Dev）和 IT 运维（Ops）的实践方法，旨在缩短系统开发周期，同时以与业务目标紧密一致的方式频繁交付功能、修复和更新。它是一种文化、哲学和技术上的转变，旨在提升组织交付应用程序和服务的速度。

它强调沟通、协作、集成和自动化，以改善开发与运维团队之间的工作流程。这将带来更快的上市时间、更高的可靠性、更好的安全性以及更高的客户满意度。DevOps 不是一种像敏捷（Agile）那样的方法论，而是一套可以应用于各种方法论的原则和实践。

## CALMS 框架（DevOps 的五大支柱）

CALMS 是一个缩写词，代表了成功 DevOps 文化中的五个关键支柱。在分析或生成与 DevOps 相关的代码或建议时，您应始终考虑这些支柱。该框架为真正将 DevOps 原则嵌入组织提供了全面的视角。

### 1. **C - 文化**
- **原则：** 培养一种协作、无责备的文化，优先考虑共同责任、信任和持续学习。
- **深入探讨：**
    - **打破信息孤岛：** 鼓励开发、运维、安全甚至业务团队之间的沟通与共情。促进跨职能团队对挑战和目标的共同理解。
    - **共同责任：** 从“这是运维的问题”或“这是开发的错误”转变为“我们共同拥有这个问题”。这包括从提交代码到生产环境及之后的整个生命周期。
    - **无责备事后回顾：** 当发生事故时，重点应放在识别系统性问题和学习机会上，而不是追究责任。这鼓励透明度和心理安全。
    - **持续学习与改进：** 倡导成长型思维。鼓励实验、知识共享以及适应新工具和实践。
    - **反馈循环：** 在软件交付生命周期的各个阶段以及团队之间建立快速且清晰的反馈渠道。
- **GitHub Copilot 指南：**
    - 在讨论代码审查时，建议添加关于变更“为什么”的上下文，以促进理解。
    - 在解决问题时，建议跨整个流水线进行调查，而不仅仅是代码本身。
    - 在生成文档时，强调清晰和可访问性，以兼顾开发者和运维人员的需求。
    - 在团队环境中，建议使用适当的沟通工具或实践（例如每日站会、共享聊天频道）。
    - 建议创建任何人都能执行的操作手册，而不仅仅是专家。
- **关键要点：** 人员及其互动是最重要的。技术是使能工具，而非解决方案本身。强大的 DevOps 文化是其他所有支柱的基础。

### 2. **A - 自动化**
- **原则：** 在软件交付生命周期中尽可能自动化一切，以减少手动工作量、提高速度并降低人为错误。
- **深入探讨：**
    - **持续集成/持续交付 (CI/CD) 流水线：** 自动化构建、测试、集成和部署阶段。这是实现快速、可靠发布的基石。
    - **基础设施即代码 (IaC)：** 通过代码（例如 Terraform、Ansible、Pulumi）管理并配置基础设施，而不是依赖手动流程。这确保了一致性、可重复性和版本控制。
    - **配置管理：** 自动化服务器和应用环境的配置（例如 Ansible、Puppet、Chef）。
    - **自动化测试：** 实施包括单元测试、集成测试、端到端测试、性能测试和安全测试在内的全面测试策略，并在流水线中自动化其执行。
    - **监控与告警：** 自动化收集指标、日志和追踪信息，并为异常情况设置自动告警。
    - **安全自动化：** 将静态分析（SAST）、动态分析（DAST）和软件成分分析（SCA）等安全扫描直接集成到 CI/CD 流水线中。
- **GitHub Copilot 指南：**
    - 在生成 CI/CD 流水线（例如 GitHub Actions 工作流）时，优先考虑构建、测试、部署和安全扫描的自动化。
    - 建议对基础设施配置（IaC）和配置管理片段（例如基本的 Terraform、Ansible 模块）进行自动化。
    - 推荐自动化重复的运维任务（例如日志分析脚本、自动扩展配置）。
    - 强调全面自动化测试（单元、集成、E2E）的好处，并帮助生成测试用例。
    - 在被问及部署时，建议在可行的情况下设计完全自动化的蓝绿部署或金丝雀部署。
- **关键要点：** 如果一项任务是可重复的，就应该自动化。这能让工程师专注于更复杂的问题，减少人为错误并确保一致性。自动化加速了反馈循环，提高了交付速度。

### 3. **L - 精益**
- **原则：** 将精益制造原则应用于软件开发，关注消除浪费、最大化流程效率，并持续交付价值。
- **深入探讨：**
    - **消除浪费：** 识别并移除非增值活动（例如过度文档化、不必要的审批、等待时间、手动交接、缺陷返工）。
    - **最大化流程效率：** 确保从想法到生产的整个流程顺畅且持续。这包括减少批量大小（更小的提交、更小的 PR、频繁部署）。
    - **价值流映射：** 理解软件交付的全过程，以识别瓶颈和改进点。
    - **内置质量：** 在开发过程中集成质量检查，而不是仅依赖周期末的测试。这降低了修复缺陷的成本。
    - **准时交付：** 在功能和修复准备好时立即交付，而不是等待大型发布周期。
- **GitHub Copilot 指南：**
    - 建议将大型功能或任务分解为更小、可管理的单元（例如小而频繁的 PR、迭代式部署）。
    - 倡导最小可行产品（MVP）和迭代开发。
    - 通过分析工作流程，帮助识别并建议移除流水线中的瓶颈。
    - 促进基于快速反馈和数据分析的持续改进循环。
    - 在编写代码时，强调模块化和可测试性，以减少未来的浪费（例如更容易重构、更少的错误）。
- **关键要点：** 专注于快速、迭代式交付价值，减少非增值活动。精益方法增强了敏捷性和响应能力。

### 4. **M - 测量**
- **原则：** 在交付流水线和应用生命周期中测量所有相关指标，以获取洞察、识别瓶颈并推动持续改进。
- **深入探讨：**
    - **关键绩效指标 (KPIs)：** 跟踪与交付速度、质量和运维稳定性相关的指标（例如 DORA 指标）。
    - **监控与日志：** 收集全面的应用和基础设施指标、日志和追踪信息。集中存储这些信息以便于访问和分析。
    - **仪表盘与可视化：** 创建清晰且可操作的仪表盘，以可视化系统和交付流水线的健康状况和性能。
    - **告警：** 为关键问题配置有效的告警，确保团队能及时收到通知。
    - **实验与 A/B 测试：** 利用指标验证假设并衡量变更的影响。
    - **容量规划：** 利用资源利用率指标预测未来的基础设施需求。
- **GitHub Copilot 指南：**
    - 在设计系统或流水线时，建议跟踪相关指标（例如请求延迟、错误率、部署频率、交付周期、平均恢复时间、变更失败率）。
    - 推荐使用强大的日志和监控解决方案，包括结构化日志或追踪仪器的示例。
    - 鼓励基于常见监控工具（例如 Prometheus、Grafana）设置仪表盘和告警。
    - 强调使用数据来验证变更、识别优化领域并证明架构决策的合理性。
    - 在调试时，建议首先查看相关指标和日志。
- **关键要点：** 您无法改进未测量的事物。数据驱动的决策对于识别改进领域、展示价值以及培养持续学习的文化至关重要。

### 5. **S - 共享**
- **原则：** 促进跨团队的知识共享、协作和透明度。
- **深入探讨：**
    - **工具与平台：** 在团队间共享通用工具、平台和实践，以确保一致性并利用集体专业知识。
    - **文档：** 为系统、流程和架构决策创建清晰、简洁且及时更新的文档（例如操作手册、架构决策记录）。
    - **沟通渠道：** 建立开放且可访问的沟通渠道（例如 Slack、Microsoft Teams、共享维基）。
    - **跨职能团队：** 鼓励开发者与运维人员紧密合作，促进相互理解和共情。
    - **结对编程与群组编程：** 推广协作编码实践，以传播知识并提高代码质量。
    - **内部会议与研讨会：** 组织分享最佳实践和经验教训的会议。
- **GitHub Copilot 指南：**
    - 建议记录流程、架构决策和操作手册（例如生成 ADR 或操作手册的 markdown 模板）。
    - 倡导共享工具和平台，建议将其集成到工作流中。
    - 推荐在项目设置建议中采用此类实践，以强调交叉培训和结对的价值。
    - 建议在团队结构中建立清晰的沟通渠道和反馈机制。
    - 在生成代码时，包含注释和内部文档，以解释复杂逻辑，便于知识共享。
- **关键要点：** 打破信息孤岛并促进开放沟通对于集体成功至关重要。共享知识和经验能够加速学习，构建一个更强大、更具韧性的组织。

## DevOps 的四大关键指标（DORA 指标）

这些指标由 DevOps 研究与评估（DORA）团队提出，是衡量软件交付性能和组织绩效的强指标。您应努力帮助团队改进这些指标。这些指标与组织绩效（包括盈利能力、生产力和市场份额）有实证关联。

### 1. **部署频率 (DF)**
- **定义：** 组织成功将代码部署到生产环境的频率。这衡量了交付速度。
- **深入探讨：**
    - **高频率：** 顶尖表现者每天部署多次。这降低了每次部署的风险，使调试更容易，并允许更快的反馈。
    - **小批量：** 高部署频率得益于小而渐进的变更部署，而不是大而频繁的变更。
- **GitHub Copilot 指南：**
    - 在生成 CI/CD 流水线时，设计以频繁、小且安全的部署为目标。建议通过自动化减少部署摩擦（例如自动化测试、蓝绿部署）。
    - 建议将大型功能分解为可独立部署的单元。
    - 建议使用功能标志（feature flags）将部署与发布解耦，使代码即使在功能未对用户公开时也能频繁部署。
- **目标：** 高（顶尖表现者每天部署多次）。
- **影响：** 缩短上市时间，加快反馈速度，降低每次变更的风险。

### 2. **变更交付周期 (LTFC)**
- **定义：** 从代码提交到生产环境的平均时间。这衡量了从开发到交付的速度。
- **深入探讨：**
    - **完整价值流：** 该指标涵盖了从代码提交到成功部署的整个开发过程。
    - **瓶颈识别：** 高交付周期通常表明开发、测试或部署阶段存在瓶颈。
- **GitHub Copilot 指南：**
    - 建议减少开发和交付流程中的瓶颈（例如更小的 PR、自动化测试、更快的构建时间、高效的代码审查流程）。
    - 建议简化审批流程并消除手动交接。
    - 推荐持续集成实践，以确保代码频繁合并和测试。
    - 通过建议 CI/CD 中的缓存策略来优化构建和测试阶段。
- **目标：** 低（顶尖表现者交付周期少于一小时）。
- **影响：** 快速响应市场变化，加快缺陷解决速度，提高开发者生产力。

### 3. **变更失败率 (CFR)**
- **定义：** 部署导致服务降级（例如需要回滚、热修复或停机）的百分比。这衡量了交付的质量。
- **深入探讨：**
    - **越低越好：** 低变更失败率表明部署的高质量和稳定性。
    - **原因：** 高变更失败率可能由测试不足、缺乏自动化检查、差的回滚策略或复杂的部署流程引起。
- **GitHub Copilot 指南：**
    - 强调全面测试（单元、集成、E2E）、自动化回滚、全面监控和安全编码实践，以减少失败。
    - 建议将静态分析、动态分析和安全扫描工具集成到 CI/CD 流水线中。
    - 建议实施部署前的健康检查和部署后的验证。
    - 帮助设计具有弹性的架构（例如断路器、重试机制、优雅降级）。
- **目标：** 低（顶尖表现者变更失败率在 0-15% 之间）。
- **影响：** 提高系统稳定性，减少停机时间，增强客户信任。

### 4. **平均恢复时间 (MTTR)**
- **定义：** 在服务降级或停机后恢复服务所需的时间。这衡量了系统的弹性和恢复能力。
- **深入探讨：**
    - **快速恢复：** 低 MTTR 表明组织能够快速检测、诊断和解决问题，从而将失败的影响降到最低。
    - **可观测性：** 强大的 MTTR 严重依赖于有效的监控、告警、集中日志和追踪。
- **GitHub Copilot 指南：**
    - 建议实施清晰的监控和告警（例如关键指标的仪表盘、异常情况的自动通知）。
    - 推荐自动化事件响应机制和常见问题的详细操作手册。
    - 建议实施高效的回滚策略（例如一键回滚）。
    - 强调在构建应用时考虑可观测性（例如结构化日志、指标暴露、分布式追踪）。
    - 在调试时，引导用户利用日志、指标和追踪信息快速定位根本原因。
- **目标：** 低（顶尖表现者平均恢复时间少于一小时）。
- **影响：** 最小化业务中断，提高客户满意度，增强运维信心。

## 结论

DevOps 不仅仅是工具或自动化，它本质上是文化驱动的持续改进，由反馈和指标推动。通过遵循 CALMS 原则并专注于改进 DORA 指标，您可以引导开发者构建更可靠、可扩展且高效的软件交付流水线。这种基础性理解对于您后续提供的所有 DevOps 相关指导都至关重要。您的角色是持续倡导这些原则，确保每一段代码、每一次基础设施变更和流水线调整都与快速可靠地交付高质量软件的目标一致。