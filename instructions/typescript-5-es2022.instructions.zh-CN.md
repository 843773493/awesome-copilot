

---
description: '面向TypeScript 5.x及ES2022输出的TypeScript开发指南'
applyTo: '**/*.ts'
---

# TypeScript开发

> 这些说明假设项目使用TypeScript 5.x（或更高版本）构建，并编译为ES2022 JavaScript基础。如果您的运行时需要更旧的语言目标或向下级转换，请调整指导方针。

## 核心目标

- 尊重现有的架构和编码规范。
- 优先选择可读、明确的解决方案，而非巧妙的捷径。
- 在引入新抽象之前，优先扩展现有抽象。
- 优先考虑可维护性和清晰度，保持方法和类简短，编写整洁的代码。

## 通用规范

- 目标为TypeScript 5.x / ES2022，优先使用原生特性而非polyfill。
- 使用纯ES模块；绝不生成`require`、`module.exports`或CommonJS辅助函数。
- 除非另有说明，否则依赖项目的构建、检查和测试脚本。
- 当意图不明确时，需注明设计权衡。

## 项目组织

- 新代码应遵循仓库的文件夹和职责布局。
- 除非另有说明，否则使用kebab-case文件名（例如：`user-session.ts`、`data-service.ts`）。
- 在有助于发现时，将测试、类型和辅助函数置于其实现附近。
- 在添加新功能前，优先重用或扩展共享工具。

## 命名与风格

- 类、接口、枚举和类型别名使用PascalCase；其他内容使用camelCase。
- 避免使用如`I`这样的接口前缀；依赖描述性名称。
- 为行为或领域含义命名事物，而非实现细节。

## 格式与风格

- 在提交前运行仓库的lint/format脚本（例如：`npm run lint`）。
- 遵循项目的缩进、引号风格和尾随逗号规则。
- 保持函数专注；当逻辑分支增多时，提取辅助函数。
- 在实际可行时，优先使用不可变数据和纯函数。

## 类型系统期望

- 避免使用`any`（显式或隐式）；优先使用`unknown`并配合类型缩小。
- 对实时事件和状态机使用区分联合类型。
- 集中化共享契约，而非重复定义形状。
- 使用TypeScript工具类型表达意图（例如：`Readonly`、`Partial`、`Record`）。

## 异步、事件与错误处理

- 使用`async/await`；通过try/catch结构化错误包裹await调用。
- 早期处理边缘情况以避免深层嵌套。
- 通过项目的日志/遥测工具发送错误。
- 通过仓库的通知模式暴露面向用户的错误。
- 对配置驱动的更新进行防抖，并确定性地释放资源。

## 架构与模式

- 遵循仓库的依赖注入或组合模式；保持模块单一职责。
- 在连接生命周期时，观察现有的初始化和释放序列。
- 保持传输层、领域层和展示层解耦，使用清晰的接口。
- 添加服务时提供生命周期钩子（例如：`initialize`、`dispose`）和针对性测试。

## 外部集成

- 在热点路径之外实例化客户端，并通过注入实现可测试性。
- 绝不硬编码秘密；从安全来源加载它们。
- 对网络或IO调用应用重试、退避和取消机制。
- 标准化外部响应并映射错误到领域形状。

## 安全实践

- 使用模式验证器或类型守卫验证和清理外部输入。
- 避免动态代码执行和不可信的模板渲染。
- 在渲染HTML前对不可信内容进行编码；使用框架转义或可信类型。
- 使用参数化查询或预处理语句阻止注入。
- 将秘密存储在安全存储中，定期轮换，并请求最小特权作用域。
- 对敏感数据优先使用不可变流程和防御性拷贝。
- 仅使用经过验证的加密库。
- 及时修补依赖项并监控安全公告。

## 配置与秘密

- 通过共享辅助函数获取配置，并使用模式或专用验证器进行验证。
- 通过项目的安全存储处理秘密；保护`undefined`和错误状态。
- 文档化新配置键并更新相关测试。

## UI与UX组件

- 在渲染前清理用户或外部内容。
- 保持UI层简洁；将复杂逻辑推送到服务或状态管理器。
- 使用消息或事件解耦UI与业务逻辑。

## 测试期望

- 使用项目的框架和命名风格添加或更新单元测试。
- 当行为跨越模块或平台API时，扩展集成或端到端测试套件。
- 在提交前运行针对性测试脚本以获取快速反馈。
- 避免脆弱的定时断言；优先使用模拟时钟或注入时钟。

## 性能与可靠性

- 延迟加载重型依赖项，并在使用完毕后释放它们。
- 将昂贵的操作延迟到用户需要时执行。
- 批量处理或防抖高频事件以减少资源浪费。
- 跟踪资源生命周期以防止泄漏。

## 文档与注释

- 为公共API添加JSDoc；在需要时包含`@remarks`或`@example`。
- 编写能捕捉意图的注释，并在重构时移除过时的注释。
- 引入重要模式时更新架构或设计文档。