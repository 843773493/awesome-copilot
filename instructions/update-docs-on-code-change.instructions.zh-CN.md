

---
description: '当应用程序代码更改需要更新文档时，自动更新README.md和其他文档文件'
applyTo: '**/*.{md,js,mjs,cjs,ts,tsx,jsx,py,java,cs,go,rb,php,rs,cpp,c,h,hpp}'
---

# 代码变更时更新文档

## 概述

通过自动检测README.md、API文档、配置指南和其他文档文件是否需要更新，确保文档与代码变更保持同步。

## 指令部分与配置

以下部分，“指令部分”和“可配置指令部分”仅适用于本指令文件，旨在提供一种简便的方法来修改Copilot指令的实现方式。本质上，这两个部分旨在开启或关闭实际Copilot指令中的某些部分或章节，并允许在特定情况和条件下对文档的某些部分进行自定义实现。

### 指令部分与可配置指令部分

本文件中包含多个指令部分。指令部分的开始由二级标题标识。称这些为**指令部分**。一些指令部分是可配置的，一些则不可配置且始终被使用。

**可配置指令部分**不是必需的，它们会受到额外的上下文和/或条件的影响。称这些为**可配置指令部分**。

**可配置指令部分**会在二级标题后附加该部分的配置属性，用反引号包裹（例如，`apply-this`）。称这个为**可配置属性**。

**可配置属性**会在本节的“指令配置”部分中声明和定义。它们是布尔值。如果为`true`，则应用、使用和/或遵循该部分的指令。

每个**可配置指令部分**还会在该部分的二级标题后有一句描述该部分配置细节的句子。称这个为**配置细节**。

**配置细节**是可配置指令部分的规则子集，这些规则扩展了可配置指令部分。这允许检查特定情况和/或条件，以确定该**可配置指令部分**的最终实现方式。

在决定如何应用一个**可配置指令部分**之前，请检查该**可配置属性**的嵌套和/或对应的`apply-condition`，并在确定该**可配置指令部分**的最终方法时使用`apply-condition`。默认情况下，每个**可配置属性**的`apply-condition`是未设置的，但一个设置的`apply-condition`示例可能是：

    - **apply-condition** :
      ` this.parent.property = (git.branch == "master") ? this.parent.property = true : this.parent.property = false; `

所有**常量指令部分**和**可配置指令部分**的总和将决定需要遵循的完整指令。称这个为**编译后的指令**。

**编译后的指令**依赖于配置。包含在**编译后的指令**中的每个指令部分都将被视为独立于本指令文件整体的单独指令集。称这个为**最终流程**。

### 指令配置

- **apply-doc-file-structure** : true
  - **apply-condition** : 未设置
- **apply-doc-verification** : true
  - **apply-condition** : 未设置
- **apply-doc-quality-standard** : true
  - **apply-condition** : 未设置
- **apply-automation-tooling** : true
  - **apply-condition** : 未设置
- **apply-doc-patterns** : true
  - **apply-condition** : 未设置
- **apply-best-practices** : true
  - **apply-condition** : 未设置
- **apply-validation-commands** : true
  - **apply-condition** : 未设置
- **apply-maintenance-schedule** : true
  - **apply-condition** : 未设置
- **apply-git-integration** : false
  - **apply-condition** : 未设置

<!--
| 配置属性         | 默认值 | 描述                                                                 | 何时启用/禁用                                      |
|------------------|--------|----------------------------------------------------------------------|-----------------------------------------------------|
| apply-doc-file-structure | true   | 确保文档遵循一致的文件结构。                                         | 如果您希望允许自由形式的文档组织，禁用此配置。        |
| apply-doc-verification  | true   | 验证文档是否与代码变更匹配。                                           | 如果验证在其他地方处理，禁用此配置。                 |
| apply-doc-quality-standard | true | 强制执行文档质量标准。                                                 | 如果不需要质量标准，禁用此配置。                     |
| apply-automation-tooling | true | 使用自动化工具更新文档。                                                | 如果您更喜欢手动更新文档，禁用此配置。               |
| apply-doc-patterns      | true   | 应用常见的文档模式和模板。                                              | 如果您使用自定义或非常规的文档风格，禁用此配置。     |
| apply-best-practices    | true   | 强制执行文档中的最佳实践。                                              | 如果最佳实践不是优先事项，禁用此配置。               |
| apply-validation-commands | true | 运行验证命令以检查文档的正确性。                                       | 如果不需要验证，禁用此配置。                         |
| apply-maintenance-schedule | true | 安排定期的文档维护。                                                   | 如果维护方式不同，禁用此配置。                       |
| apply-git-integration   | false  | 将文档更新与Git工作流程集成。                                           | 如果您希望自动集成Git，启用此配置。                  |
-->

## 文档更新时机

### 触发条件

当以下情况发生时，自动检查文档是否需要更新：

- 新增功能或功能
- API端点、方法或接口变更
- 引入破坏性变更
- 依赖项或需求变更
- 配置选项或环境变量修改
- 安装或设置流程变更
- 命令行接口或脚本更新
- 文档中的代码示例过时

## 文档更新规则

### README.md更新

**在以下情况下始终更新README.md：**

- 新增功能或能力
  - 在“功能”部分添加功能描述
  - 如有需要，包含使用示例
  - 如果存在，更新目录

- 修改安装或设置流程
  - 更新“安装”或“快速入门”部分
  - 修订依赖项需求
  - 更新前置条件列表

- 新增CLI命令或选项
  - 文档命令语法和示例
  - 包含选项描述和默认值
  - 添加使用示例

- 修改配置选项
  - 更新配置示例
  - 文档新增环境变量
  - 更新配置文件模板

### API文档更新

**在以下情况下同步API文档：**

- 新增端点
  - 文档HTTP方法、路径和参数
  - 包含请求/响应示例
  - 更新OpenAPI/Swagger规范

- 端点签名变更
  - 更新参数列表
  - 修订响应模式
  - 文档破坏性变更

- 认证或授权变更
  - 更新认证示例
  - 修订安全需求
  - 更新API密钥/令牌文档

### 代码示例同步

**在以下情况下验证和更新代码示例：**

- 函数签名变更
  - 更新使用该函数的所有代码片段
  - 验证示例是否仍能编译/运行
  - 如有必要，更新导入语句

- API接口变更
  - 更新示例请求和响应
  - 修订客户端代码示例
  - 更新SDK使用示例

- 最佳实践演变
  - 替换示例中的过时模式
  - 更新为当前推荐的方法
  - 添加旧模式的弃用通知

### 配置文档更新

**在以下情况下更新配置文档：**

- 新增环境变量
  - 添加到.env.example文件
  - 在README.md或docs/configuration.md中文档
  - 包含默认值和描述

- 配置文件结构变更
  - 更新示例配置文件
  - 文档新选项
  - 标记弃用选项

- 部署配置变更
  - 更新Docker/Kubernetes配置
  - 修订部署指南
  - 更新基础设施即代码示例

### 迁移和破坏性变更

**在以下情况下创建迁移指南：**

- 发生破坏性API变更
  - 文档变更内容
  - 提供变更前后的示例
  - 包含逐步迁移说明

- 主版本更新
  - 列出所有破坏性变更
  - 提供升级检查清单
  - 包含常见迁移问题和解决方案

- 弃用功能
  - 明确标记弃用功能
  - 建议替代方法
  - 设置移除时间线

## 文档文件结构 `apply-doc-file-structure`

如果`apply-doc-file-structure == true`，则应用以下可配置指令部分。

### 标准文档文件

维护这些文档文件并根据需要进行更新：

- **README.md**：项目概述、快速入门、基本使用
- **CHANGELOG.md**：版本历史和用户可见变更
- **docs/**：详细文档
  - `installation.md`：安装和设置指南
  - `configuration.md`：配置选项和示例
  - `api.md`：API参考文档
  - `contributing.md`：贡献指南
  - `migration-guides/`：版本迁移指南
- **examples/**：可运行的代码示例和教程

### 版本日志管理

**为以下内容添加版本日志条目：**

- 新增功能（在“新增”部分）
- 错误修复（在“修复”部分）
- 破坏性变更（在“变更”部分带有**BREAKING**前缀）
- 弃用功能（在“弃用”部分）
- 移除功能（在“移除”部分）
- 安全修复（在“安全”部分）

**版本日志格式：**

    ```markdown
    ## [版本] - YYYY-MM-DD

    ### 新增
    - 新功能描述并引用PR/问题

    ### 变更
    - **BREAKING**：破坏性变更描述
    - 其他变更

    ### 修复
    - 错误修复描述
    ```

## 文档验证 `apply-doc-verification`

如果`apply-doc-verification == true`，则应用以下可配置指令部分。

### 在应用变更前

**检查文档完整性：**

1. 所有新增的公共API都应文档化
2. 文档中的代码示例应能编译和运行
3. 文档中的链接应有效
4. 配置示例应准确
5. 安装步骤应为最新
6. README.md应反映当前状态

### 文档测试

**包含文档验证：**

#### 示例任务

- 验证文档中的代码示例是否能编译/运行
- 检查内部/外部链接是否损坏
- 将配置示例与模式进行验证
- 确保API示例与当前实现匹配

    ```bash
    # 示例验证命令
    npm run docs:check         # 验证文档构建
    npm run docs:test-examples # 测试文档中的代码示例
    npm run docs:lint         # 检查问题
    ```

## 文档质量标准 `apply-doc-quality-standard`

如果`apply-doc-quality-standard == true`，则应用以下可配置指令部分。

### 写作指南

- 使用清晰简洁的语言
- 包含可运行的代码示例
- 提供基础和高级示例
- 使用一致的术语
- 包含错误处理示例
- 文档边缘情况和限制

### 代码示例格式

    ```markdown
    ### 示例：[清晰描述示例展示的内容]

    \`\`\`language
    // 包含必要的导入/设置
    import { function } from 'package';

    // 完整、可运行的示例
    const result = function(parameter);
    console.log(result);
    \`\`\`

    **输出:**
    \`\`\`
    预期输出
    \`\`\`
    ```

### API文档格式

    ```markdown
    ### `functionName(param1, param2)`

    函数的简要描述。

    **参数:**
    - `param1` (类型): 参数描述
    - `param2` (类型, 可选): 带有默认值的描述

    **返回:**
    - `类型`: 返回值描述

    **示例:**
    \`\`\`language
    const result = functionName('value', 42);
    \`\`\`

    **抛出:**
    - `ErrorType`: 抛出错误的条件和原因
    ```

## 自动化和工具 `apply-automation-tooling`

如果`apply-automation-tooling == true`，则应用以下可配置指令部分。

### 文档生成

**在可用时使用自动化工具：**

#### 自动化工具示例

- JSDoc/TSDoc用于JavaScript/TypeScript
- Sphinx/pdoc用于Python
- Javadoc用于Java
- xmldoc用于C#
- godoc用于Go
- rustdoc用于Rust

### 文档检查

**使用以下工具验证文档：**

- Markdown检查器（markdownlint）
- 链接检查器（markdown-link-check）
- 拼写检查器（cspell）
- 代码示例验证器

### 更新前钩子

**为以下内容添加提交前检查：**

- 文档构建成功
- 无损坏链接
- 代码示例有效
- 存在变更的版本日志条目

## 常见文档模式 `apply-doc-patterns`

如果`apply-doc-patterns == true`，则应用以下可配置指令部分。

### 功能文档模板

    ```markdown
    ## 功能名称

    功能的简要描述。

    ### 使用方法

    基础使用示例和代码片段。

    ### 配置

    配置选项和示例。

    ### 高级使用

    复杂场景和边缘情况。

    ### 故障排除

    常见问题和解决方案。
    ```

### API端点文档模板

    ```markdown
    ### `HTTP_METHOD /api/endpoint`

    描述该端点的功能。

    **请求:**
    \`\`\`json
    {
      "param": "value"
    }
    \`\`\`

    **响应:**
    \`\`\`json
    {
      "result": "value"
    }
    \`\`\`

    **状态码:**
    - 200: 成功
    - 400: 错误请求
    - 401: 未授权
    ```

## 最佳实践 `apply-best-practices`

如果`apply-best-practices == true`，则应用以下可配置指令部分。

### 应该怎么做

- ✅ 在同一个提交中更新文档
- ✅ 在应用变更前包含变更前后的示例
- ✅ 提交前测试代码示例
- ✅ 使用一致的格式和术语
- ✅ 文档限制和边缘情况
- ✅ 为破坏性变更提供迁移路径
- ✅ 保持文档简洁（DRY），通过链接而非复制

### 不应该怎么做

- ❌ 在提交代码变更时不更新文档
- ❌ 在文档中留下过时的示例
- ❌ 文档尚未存在的功能
- ❌ 使用模糊或含糊的语言
- ❌ 忘记更新版本日志
- ❌ 忽略损坏的链接或失败的示例
- ❌ 文档用户不需要的实现细节

## 验证示例命令 `apply-validation-commands`

如果`apply-validation-commands == true`，则应用以下可配置指令部分。

用于文档验证的示例脚本：

```json
{
  "scripts": {
    "docs:build": "构建文档",
    "docs:test": "测试文档中的代码示例",
    "docs:lint": "检查文档文件",
    "docs:links": "检查损坏的链接",
    "docs:spell": "检查文档拼写",
    "docs:validate": "运行所有文档检查"
  }
}
```

## 维护计划 `apply-maintenance-schedule`

如果`apply-maintenance-schedule == true`，则应用以下可配置指令部分。

### 定期审查

- **每月**：审查文档的准确性
- **每次发布**：更新版本号和示例
- **每季度**：检查过时模式或弃用功能
- **每年**：进行全面的文档审计

### 弃用流程

当弃用功能时：

1. 在文档中添加弃用通知
2. 更新示例以使用推荐的替代方案
3. 创建迁移指南
4. 在版本日志中添加弃用通知
5. 设置移除时间线
6. 在下一个主版本中移除弃用功能和文档

## Git集成 `apply-git-integration`

如果`apply-git-integration == true`，则应用以下可配置指令部分。

### 拉取请求要求

**代码变更必须与文档变更在同一拉取请求中：**

- 在功能拉取请求中文档新功能
- 代码变更时更新示例
- 与代码变更添加版本日志条目
- 接口变更时更新API文档

### 文档审查

**在代码审查中验证：**

- 文档准确描述了变更
- 示例清晰且完整
- 没有未文档化的破坏性变更
- 版本日志条目适当
- 如有需要，提供迁移指南

## 审查清单

在考虑文档完成并确定**最终流程**之前，请检查以下事项：

- [ ] **编译后的指令**基于**常量指令部分**和**可配置指令部分**的总和
- [ ] README.md反映当前项目状态
- [ ] 所有新增功能都已文档化
- [ ] 代码示例已测试并能运行
- [ ] API文档完整且准确
- [ ] 配置示例是最新的
- [ ] 破坏性变更已文档化并提供迁移指南
- [ ] CHANGELOG.md已更新
- [ ] 链接有效且未损坏
- [ ] 安装说明是最新的
- [ ] 环境变量已文档化