

---
description: '构建 C# 应用程序的指南'
applyTo: '**/*.cs'
---

# C# 开发

## C# 指南
- 始终使用最新版本的 C#，目前使用 C# 14 特性。
- 为每个函数编写清晰简洁的注释。

## 通用指南
- 在审查代码更改时，仅在高置信度时提出建议。
- 编写具有良好可维护性实践的代码，包括对某些设计决策原因的注释。
- 处理边界情况并编写清晰的异常处理。
- 对于库或外部依赖项，在注释中说明其用途和使用方法。

## 命名规范

- 为组件名称、方法名称和公共成员遵循 PascalCase 命名规范。
- 使用 camelCase 命名私有字段和局部变量。
- 接口名称以 "I" 前缀开头（例如：IUserService）。

## 格式化

- 应用由 `.editorconfig` 定义的代码格式化样式。
- 优先使用文件作用域的命名空间声明和单行 using 指令。
- 在任何代码块的打开大括号前插入换行符（例如，在 if、for、while、foreach、using、try 等之后）。
- 确保方法的最终返回语句单独成行。
- 尽可能使用模式匹配和 switch 表达式。
- 在引用成员名称时，使用 `nameof` 而不是字符串字面量。
- 为所有公共 API 创建 XML 文档注释。在适用时，包含 `<example>` 和 `<code>` 文档说明。

## 项目设置与结构

- 引导用户通过使用适当的模板创建新的 .NET 项目。
- 解释每个生成的文件和文件夹的用途，以帮助理解项目结构。
- 展示如何使用功能文件夹或领域驱动设计原则来组织代码。
- 展示如何通过模型、服务和数据访问层实现职责分离。
- 解释 ASP.NET Core 10 中的 Program.cs 文件和配置系统，包括环境特定的设置。

## 可空引用类型

- 声明变量为非空类型，并在入口点检查 null 值。
- 始终使用 `is null` 或 `is not null` 而不是 `== null` 或 `!= null`。
- 信任 C# 的 null 注解，当类型系统表明值不能为 null 时，不要添加 null 检查。

## 数据访问模式

- 指导用户使用 Entity Framework Core 实现数据访问层。
- 解释开发和生产环境中不同选项（SQL Server、SQLite、内存数据库）的使用。
- 展示仓储模式的实现及其适用场景。
- 展示如何实现数据库迁移和数据播种。
- 解释高效的查询模式以避免常见的性能问题。

## 认证与授权

- 引导用户实现使用 JWT Bearer 令牌的认证。
- 解释 OAuth 2.0 和 OpenID Connect 概念及其在 ASP.NET Core 中的应用。
- 展示如何实现基于角色和策略的授权。
- 展示如何与 Microsoft Entra ID（原 Azure AD）集成。
- 解释如何一致地保护基于控制器和最小 API 的接口。

## 验证与错误处理

- 指导用户使用数据注释和 FluentValidation 实现模型验证。
- 解释验证管道以及如何自定义验证响应。
- 展示如何使用中间件实现全局异常处理策略。
- 展示如何在 API 中创建一致的错误响应。
- 解释 RFC 7807 标准化错误响应的实现方式（问题详细信息）。

## API 版本控制与文档

- 引导用户实现和解释 API 版本控制策略。
- 展示 Swagger/OpenAPI 的实现方式，并提供适当的文档说明。
- 展示如何文档化端点、参数、响应和认证。
- 解释基于控制器和最小 API 的版本控制方式。
- 指导用户创建有意义的 API 文档以帮助消费者。

## 日志记录与监控

- 指导用户使用 Serilog 或其他提供程序实现结构化日志记录。
- 解释日志级别及其适用场景。
- 展示如何与 Application Insights 集成以收集遥测数据。
- 展示如何实现自定义遥测和相关 ID 以跟踪请求。
- 解释如何监控 API 性能、错误和使用模式。

## 测试

- 为应用程序的关键路径始终包含测试用例。
- 引导用户创建单元测试。
- 不要添加 "Act"、"Arrange" 或 "Assert" 注释。
- 为测试方法名称和大小写复制附近文件的现有风格。
- 解释 API 端点的集成测试方法。
- 展示如何模拟依赖项以实现有效的测试。
- 展示如何测试认证和授权逻辑。
- 解释测试驱动开发原则在 API 开发中的应用。

## 性能优化

- 指导用户实现缓存策略（内存缓存、分布式缓存、响应缓存）。
- 解释异步编程模式及其对 API 性能的重要性。
- 展示对大数据集的分页、过滤和排序方法。
- 展示如何实现压缩和其他性能优化技术。
- 解释如何测量和基准 API 性能。

## 部署与 DevOps

- 引导用户通过 .NET 内置的容器支持将 API 容器化（例如：`dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer`）。
- 解释手动创建 Dockerfile 与 .NET 容器发布功能之间的区别。
- 解释 .NET 应用程序的 CI/CD 流水线。
- 展示如何将 API 部署到 Azure App Service、Azure Container Apps 或其他托管选项。
- 展示如何实现健康检查和就绪探针。
- 解释不同部署阶段的环境特定配置。