

---
描述: '创建高质量 GitHub Copilot 自定义指令文件的指南'
适用范围: '**/*.instructions.md'
---

# 自定义指令文件指南

创建有效且易于维护的自定义指令文件的指导，这些文件将指导 GitHub Copilot 生成特定领域代码并遵循项目规范。

## 项目背景

- 目标受众：开发者和使用特定领域代码的 GitHub Copilot
- 文件格式：Markdown 格式，包含 YAML 前置内容
- 文件命名规范：小写格式，使用短横线分隔（例如：`react-best-practices.instructions.md`）
- 存储位置：位于 `.github/instructions/` 目录下
- 目的：为代码生成、代码审查和文档编写提供上下文感知的指导

## 必须的前置内容

每个指令文件必须包含 YAML 前置内容，其中包含以下字段：

```yaml
---
描述: '简要说明指令的目的和适用范围'
适用范围: '目标文件的 glob 模式（例如：**/*.ts, **/*.py）'
---
```

### 前置内容指南

- **描述**：单引号字符串，1-500 字符，明确说明指令的目的
- **适用范围**：指定这些指令适用的文件的 glob 模式
  - 单一模式：`'**/*.ts'`
  - 多个模式：`'**/*.ts, **/*.tsx, **/*.js'`
  - 特定文件：`'src/**/*.py'`
  - 所有文件：`'**'`

## 文件结构

一个结构良好的指令文件应包含以下部分：

### 1. 标题和概述

- 使用 `#` 标题明确、描述性的标题
- 简要介绍，说明目的和适用范围
- 可选：包含项目背景部分，列出关键技术和版本

### 2. 核心部分

根据领域将内容组织为逻辑部分：

- **通用指导**：高层次的指导原则和规范
- **最佳实践**：推荐的模式和方法
- **代码规范**：命名规范、格式规范、风格规则
- **架构/结构**：项目组织结构和设计模式
- **常见模式**：常用实现方式
- **安全性**：适用的安全性考虑（如适用）
- **性能**：优化指导（如适用）
- **测试**：测试标准和方法（如适用）

### 3. 示例和代码片段

提供明确标注的实例：

```markdown
### 良好示例
\`\`\`语言
// 推荐方法
代码示例在此
\`\`\`

### 不良示例
\`\`\`语言
// 避免这种模式
代码示例在此
\`\`\`
```

### 4. 验证和确认（可选但推荐）

- 验证代码的构建命令
- 代码规范和格式化工具
- 测试要求
- 确认步骤

## 内容指南

### 写作风格

- 使用清晰简洁的语言
- 采用祈使语气（如 "使用"、"实现"、"避免"）
- 具体且可操作
- 避免模糊术语如 "应该"、"可能"、"或许"
- 使用项目符号和列表提高可读性
- 保持各部分专注且便于快速浏览

### 最佳实践

- **具体说明**：提供具体的示例而非抽象概念
- **解释原因**：在推荐理由有附加价值时解释推荐背后的理由
- **使用表格**：用于比较选项、列出规则或展示模式
- **包含示例**：实际代码片段比描述更有效
- **保持时效性**：引用当前版本和最佳实践
- **链接资源**：包含官方文档和权威来源

### 常见模式

1. **命名规范**：变量、函数、类、文件的命名方式
2. **代码组织**：文件结构、模块组织、导入顺序
3. **错误处理**：推荐的错误处理模式
4. **依赖项**：依赖项的管理和文档说明
5. **注释和文档**：何时以及如何注释代码
6. **版本信息**：目标语言/框架的版本

## 应遵循的模式

### 项目符号和列表

```markdown
## 安全最佳实践

- 在处理用户输入前始终进行验证
- 使用参数化查询以防止 SQL 注入
- 将机密存储在环境变量中，而不是代码中
- 实现适当的认证和授权
- 为所有生产端点启用 HTTPS
```

### 表格用于结构化信息

```markdown
## 常见问题

| 问题            | 解决方案            | 示例                       |
| ---------------- | ------------------- | ----------------------------- |
| 魔法数字    | 使用命名常量 | `const MAX_RETRIES = 3`       |
| 深层嵌套     | 提取函数   | 重构嵌套的 if 语句 |
| 硬编码值 | 使用配置   | 在配置中存储 API URL      |
```

### 代码对比

```markdown
### 良好示例 - 使用 TypeScript 接口
\`\`\`typescript
interface User {
  id: string;
  name: string;
  email: string;
}

function getUser(id: string): User {
  // 实现
}
\`\`\`

### 不良示例 - 使用 any 类型
\`\`\`typescript
function getUser(id: any): any {
  // 丧失类型安全性
}
\`\`\`
```

### 条件性指导

```markdown
## 框架选择

- **小型项目**：使用 Minimal API 方法
- **大型项目**：使用基于控制器的架构，明确分离职责
- **微服务**：考虑领域驱动设计模式
```

## 应避免的模式

- **过于冗长的解释**：保持简洁和可扫描性
- **过时信息**：始终引用当前版本和实践
- **模糊的指导**：明确说明应执行或避免的具体操作
- **缺少示例**：没有具体代码示例的抽象规则
- **矛盾的建议**：确保文件内容的一致性
- **直接复制粘贴文档内容**：通过提炼和上下文化增加价值

## 测试您的指令

在最终确定指令文件前：

1. **使用 Copilot 测试**：在 VS Code 中尝试实际提示
2. **验证示例**：确保代码示例正确且无错误
3. **检查 glob 模式**：确认 `applyTo` 模式匹配预期文件

## 示例结构

以下是新指令文件的最小示例结构：

```markdown
---
描述: '简要说明目的'
适用范围: '**/*.ext'
---

# 技术名称开发

简要介绍和背景信息。

## 通用指导

- 高层次指导原则 1
- 高层次指导原则 2

## 最佳实践

- 具体实践 1
- 具体实践 2

## 代码规范

### 命名规范
- 规则 1
- 规则 2

### 文件组织
- 结构 1
- 结构 2

## 常见模式

### 模式 1
描述和示例

\`\`\`语言
代码示例
\`\`\`

### 模式 2
描述和示例

## 验证

- 构建命令: `验证命令`
- 代码规范: `规范命令`
- 测试: `测试命令`
```

## 维护

- 当依赖项或框架更新时审查指令
- 更新示例以反映当前最佳实践
- 移除过时模式或弃用功能
- 在社区中出现新模式时添加
- 随着项目结构演变保持 glob 模式的准确性

## 其他资源

- [自定义指令文档](https://code.visualstudio.com/docs/copilot/customization/custom-instructions)
- [Awesome Copilot 指令](https://github.com/github/awesome-copilot/tree/main/instructions)