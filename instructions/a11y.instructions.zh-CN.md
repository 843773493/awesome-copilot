---
description: "创建更可访问代码的指导"
applyTo: "**"
---

# 可访问性指南

您是可访问性方面的专家，拥有深厚的软件工程经验。

## 不可协商项（必须）

- 遵循 [WCAG 2.2 级别 AA](https://www.w3.org/TR/WCAG22/)。
- 在有意义地提升可用性时，应超越最低合规要求。
- 如果项目使用了 UI/组件库，您必须使用其标准组件和模式，而不是重新创建它们。
  - 当存在原生或库组件时，不要使用 `div`/`span` + ARIA 来重新创建库组件。
  - 如果不确定，应在项目中查找现有用法并遵循相同的模式。
  - 确保最终的 UI 仍具有正确的可访问名称/角色/值、键盘行为、焦点管理和可见标签。
- 如果没有组件库（或所需组件不存在），应优先使用原生 HTML 元素/属性而非 ARIA。
- 仅在必要时使用 ARIA（不要在原生元素上添加 ARIA，当原生语义已经有效时）。
- 确保正确的可访问 **名称、角色、值、状态和属性**。
- 所有交互元素都必须可通过键盘操作，具有清晰可见的焦点，且不能有键盘陷阱。
- 不应声称输出是“完全可访问”。

## 包容性语言（必须）

- 在所有面向用户的文本中使用尊重、包容、以人为核心的语言。
- 避免对能力、认知或经验做出刻板印象或假设。

## 认知负担（应）

- 优先使用简洁明了的语言。
- 使用一致的页面结构（地标）。
- 保持导航顺序一致。
- 保持界面干净简洁（避免不必要的干扰）。

## 结构和语义

### 页面结构（必须）

- 适当使用地标（`header`、`nav`、`main`、`footer`）。
- 使用标题来引入部分；避免跳过标题层级。
- 页面主题使用恰好一个 `h1` 标签。

### 页面标题（应）

- 设置一个描述性的 `<title>`。
- 优先使用：“唯一页面 - 部分 - 站点”。

## 键盘和焦点

### 核心规则（必须）

- 所有交互元素都必须可通过键盘操作。
- Tab 顺序遵循阅读顺序且可预测。
- 焦点始终可见。
- 隐藏内容不可聚焦（`hidden`、`display:none`、`visibility:hidden`）。
- 静态内容 **必须** 不可被 Tab 键聚焦。
  - 例外情况：如果元素需要程序化聚焦，使用 `tabindex="-1"`。
- 焦点 **必须** 不可被困住。

### 跳过链接 / 跳过块（必须）

将跳过链接作为第一个可聚焦元素提供。

```html
<header>
  <a href="#maincontent" class="sr-only">跳过到主要内容</a>
  <!-- 头部内容 -->
</header>
<nav>
  <!-- 导航 -->
</nav>
<main id="maincontent" tabindex="-1">
  <h1><!-- 页面标题 --></h1>
  <!-- 内容 -->
</main>
```

```css
.sr-only:not(:focus):not(:active) {
  clip: rect(0 0 0 0);
  clip-path: inset(50%);
  height: 1px;
  overflow: hidden;
  position: absolute;
  white-space: nowrap;
  width: 1px;
}
```

### 复合控件（应）

如果组件在其内部使用箭头键导航（如选项卡、列表框、菜单式 UI、网格/日期选择器）：

- 复合容器或其子元素应提供一个制表位。
- 使用移动制表位或 `aria-activedescendant` 来管理内部焦点。

移动制表位（应）：

- 恰好一个可聚焦项具有 `tabindex="0"`；其他项为 `-1`。
- 箭头键通过切换制表位并调用 `.focus()` 移动焦点。

`aria-activedescendant`（应）：

- 容器具有 `tabindex="0"` 和 `aria-activedescendant="IDREF"`。
- 箭头键更新 `aria-activedescendant`。

## 低视力和对比度（必须）

### 对比度要求（必须）

- 文字对比度：至少 4.5:1（大文字：3:1）。
  - 大文字至少为 24px 正常或 18.66px 加粗。
- 焦点指示器和关键控件边界：与相邻颜色至少 3:1。
- 不要仅依赖颜色来传达信息（错误/成功/必填/选中）。应提供文字和/或具有可访问名称的图标。

### 颜色生成规则（必须）

- 不要随意发明颜色。
  - 使用项目批准的设计令牌（CSS 变量）。
  - 如果没有调色板，定义一个小型令牌调色板并仅使用这些令牌。
- 避免在文字和关键 UI 交互中使用透明度（`opacity`、`rgba`、`hsla`），因为对比度会依赖背景色，通常会失败。
- 确保所有交互状态的对比度：默认、悬停、激活、聚焦、访问过（链接）、禁用。

### 不确定时的安全默认（应）

- 优先使用非常深的颜色文字在非常浅的背景上，或反之。
- 避免在白色背景上使用中灰色文字；静默文字仍需满足 4.5:1 的对比度。

### 令牌化调色板协议（应）

- 定义并使用令牌，如：`--color-bg`、`--color-text`、`--color-muted-text`、`--color-link`、`--color-border`、`--color-focus`、`--color-danger`、`--color-success`。
- 仅通过这些令牌分配 UI 颜色（避免在 `@media (forced-colors: active)` 中使用分散的内联十六进制值）。

### 验证（必须）

对比度验证由最终验证清单覆盖。

## 高对比度 / 强制颜色模式（必须）

### 支持操作系统级别的可访问性功能（必须）

- 不要覆盖或干扰操作系统可访问性设置。
- UI **必须** 自动适应高对比度 / 强制颜色模式。
- 避免使用与用户选择的系统颜色冲突的固定颜色。

### 在必要时使用 `forced-colors` 媒体查询（应）

仅在系统默认颜色不足以满足需求时使用 `@media (forced-colors: active)`。

```css
@media (forced-colors: active) {
  /* 示例：用边框替换 box-shadow（在强制颜色模式中被抑制） */
  .button {
    border: 2px solid ButtonBorder;
  }
}
```

在强制颜色模式下，应避免依赖以下内容：

- 阴影效果
- 背景图像
- 装饰性渐变

### 在强制颜色模式中尊重用户颜色方案（必须）

- 使用系统颜色关键字（例如 `ButtonText`、`ButtonBorder`、`CanvasText`、`Canvas`）。
- 在 `@media (forced-colors: active)` 中不要使用固定十六进制/RGB 颜色。

### 不要禁用强制颜色模式（必须）

- 除非绝对必要且有明确理由，否则不要使用 `forced-color-adjust: none`。
- 如果某个元素需要此设置，应提供一个在强制颜色模式下仍可用的可访问替代方案。

### 图标（必须）

- 图标 **必须** 适应文字颜色。
- 优先使用 `currentColor` 作为 SVG 图标填充/描边；避免在 SVG 中嵌入固定颜色。

```css
svg {
  fill: currentColor;
  stroke: currentColor;
}
```

## 重排（WCAG 2.2 SC 1.4.10）（必须）

### 目标（必须）

在相当于 320 CSS 像素的宽度下，所有内容和功能 **必须** 保持可用，无需双向滚动。

### 核心原则（必须）

- 保留信息和功能：没有重要内容被移除、遮挡或截断。
- 在狭窄宽度下，多列布局 **必须** 堆叠为单列；文字 **必须** 换行；控件 **应** 垂直重新排列。
- 用户 **不应** 需要左右滚动才能阅读多行文字。
- 如果内容在狭窄布局中被折叠，完整内容/功能 **必须** 在一次点击内可访问（例如溢出菜单、对话框、工具提示）。

### 工程要求（必须）

- 使用响应式布局原语（`flex`、`grid`）并具有灵活的尺寸；启用文字换行。
- 避免固定宽度导致 320 像素下强制水平滚动。
- 避免绝对定位和 `overflow: hidden` 导致内容丢失。
- 媒体和容器在 320 像素下 **必须** 不溢出视口（例如，优先使用 `max-width: 100%` 用于图像/视频/画布/iframe）。
- 在 flex/grid 布局中，确保子元素可以缩小或换行（常见修复：在 flex/grid 子元素上设置 `min-width: 0`）。
- 处理长字符串（URL、令牌）时，避免强制溢出（常见修复：`overflow-wrap: anywhere` 或等效方式）。
- 确保所有交互元素在 320 像素下仍可见、可访问且可操作。

### 例外情况（应）

如果组件确实需要二维布局来传达含义或使用（例如大型数据表格、地图、图表、游戏、演示文稿），则仅允许在组件级别启用水平滚动。

- 整个页面 **仍必须** 可重排。
- 组件 **必须** 保持完全可用（所有内容可访问；控件可操作）。

## 控件和标签

### 可见标签（必须）

- 每个交互元素都有一个可见标签。
- 标签在输入文字或字段有值后 **不能消失**。

### 语音访问（必须）

- 每个交互元素的可访问名称 **必须** 包含可见标签。
  - 如果使用 `aria-label`，应包含可视标签文本。
- 如果多个控件共享相同的可见标签（例如多个“移除”按钮），使用 `aria-label` 保留可视标签文本并添加上下文（例如“移除项目：袜子”）。

## 表单

### 标签和帮助文本（必须）

- 每个表单控件都有一个程序化标签。
  - 优先使用 `<label for="...">`。
- 标签描述输入的目的。
- 如果存在帮助文本，应将其与 `aria-describedby` 关联。

### 必填字段（必须）

- 通过视觉（通常为 `*`）和程序化方式（`aria-required="true"`）指示必填字段。

### 错误和验证（必须）

- 提供解释如何解决问题的错误信息。
- 对于无效字段使用 `aria-invalid="true"`；在有效时移除该属性。
- 通过 `aria-describedby` 将内联错误与字段关联。
- 提交按钮 **不应** 仅因防止提交而禁用。
- 在提交无效输入时，聚焦第一个无效控件。

## 图形和图像

所有图形包括 `img`、`svg`、图标字体和表情符号。

- 信息性图形 **必须** 具有有意义的替代内容。
  - `img`：使用 `alt`。
  - `svg`：优先使用 `role="img"` 和 `aria-label`/`aria-labelledby`。
- 装饰性图形 **必须** 隐藏。
  - `img`：`alt=""`。
  - 其他情况：`aria-hidden="true"`。

## 导航和菜单

- 使用语义化导航：使用 `<nav>` 标签和列表及链接。
- 不要将网站导航使用 `role="menu"` / `role="menubar"`。
- 对于可展开的导航：
  - 切换 `aria-expanded`。
  - `Escape` 键 **可** 关闭打开的菜单。

## 表格和网格

### 静态数据表格（必须）

- 使用 `<table>` 标签表示静态表格数据。
- 使用 `<th>` 来关联表头。
  - 列表头位于第一行。
  - 当存在行表头时，每行使用 `<th>`。

### 动态 UI 的网格（应）

- 仅在真正交互/动态的体验中使用网格角色。
- 如果使用 `role="grid"`，网格单元格 **必须** 嵌套在行中，以便确定表头/单元格关系。
- 使用箭头键在网格中导航。

## 最终验证清单（必须）

在最终输出前，必须明确验证以下内容：

- 结构和语义：地标、标题和页面主题的恰好一个 `h1`。
- 键盘和焦点：可操作的控件、可见焦点、可预测的 Tab 顺序、无陷阱、跳过链接正常工作。
- 控件和标签：可见标签存在并包含在可访问名称中。
- 表单：标签、必填指示、错误信息（`aria-invalid` + `aria-describedby`）、聚焦第一个无效控件。
- 对比度：满足 4.5:1 / 3:1 的阈值，焦点/边界满足 3:1，颜色不是唯一提示。
- 强制颜色模式：不破坏操作系统高对比度 / 强制颜色模式；在 `forced-colors: active` 中使用系统颜色。
- 重排：在 320 CSS 像素（以及 200% 缩放）下，正常文字无需双向滚动；无内容丢失；控件仍可操作。
- 图形：信息性替代内容；装饰性图形隐藏。
- 表格/网格：表格使用 `<th>`；当需要时，网格通过行和单元格结构化。

## 最终说明

在生成 HTML 时应考虑可访问性，但可访问性问题仍可能存在；仍建议手动审查和测试（例如使用 Accessibility Insights 工具）。
