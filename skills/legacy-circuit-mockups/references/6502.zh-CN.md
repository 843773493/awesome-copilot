# MOS Technology 6502 微处理器规格

## 1. 概述

**MOS Technology 6502** 是一款于1975年推出的8位微处理器。它因低成本、高效的指令集以及在早期个人电脑和游戏机中的广泛应用而著称，包括 Apple II、Commodore 64、Atari 2600、NES（Ricoh 2A03变种）和 BBC Micro。

---

## 2. 一般特性

| 特性         | 描述                     |
| ------------ | ------------------------ |
| 数据宽度     | 8位                      |
| 地址宽度     | 16位                     |
| 地址空间     | 64 KB（0x0000–0xFFFF）   |
| 寄存器       | A, X, Y, SP, PC, P        |
| 字节序       | 小端序（Little-endian）   |
| 时钟速度     | ~1–3 MHz（原始NMOS）      |
| 工艺技术     | NMOS（双极型金属氧化物半导体） |

---

## 3. 程序员可见寄存器

### 3.1 累加器（A）

* 8位寄存器
* 用于算术运算、逻辑运算和数据传输操作

### 3.2 索引寄存器（X, Y）

* 8位寄存器
* 用于内存索引、计数器和偏移量操作

### 3.3 堆栈指针（SP）

* 8位寄存器
* 指向当前堆栈位置
* 堆栈位于页面 `$0100–$01FF`

### 3.4 程序计数器（PC）

* 16位寄存器
* 存储下一条指令的地址

### 3.5 处理器状态寄存器（P）

| 位 | 名称 | 描述                   |
| --: | ---- | ----------------------- |
| 7  | N    | 负数标志                |
| 6  | V    | 溢出标志                |
| 5  | –    | 未使用（在压栈操作中始终置位） |
| 4  | B    | 中断请求标志            |
| 3  | D    | 十进制模式标志           |
| 2  | I    | 中断禁用标志            |
| 1  | Z    | 零标志                  |
| 0  | C    | 进位标志                |

---

## 4. 内存映射约定

| 地址范围     | 使用方式               |
| ------------ | ----------------------- |
| `$0000–$00FF` | 零页（Zero Page）      |
| `$0100–$01FF` | 硬件堆栈（Hardware Stack） |
| `$0200–$FFFF` | 程序/数据/I/O空间       |

### 4.1 中断向量

| 向量 | 地址         | 描述                   |
| ---- | ------------ | ----------------------- |
| NMI  | `$FFFA–$FFFB` | 不可屏蔽中断（Non-maskable interrupt） |
| RESET | `$FFFC–$FFFD` | 复位向量（Reset vector） |
| IRQ/BRK | `$FFFE–$FFFF` | 中断请求（Interrupt request） |

---

## 5. 寻址模式

| 模式             | 语法        | 描述                     |
| ---------------- | ----------- | ------------------------- |
| 隐含寻址         | `CLC`       | 操作数隐含               |
| 累加器寻址       | `ASL A`     | 对累加器进行操作         |
| 立即数寻址       | `LDA #$10`  | 常量值                   |
| 零页寻址         | `LDA $20`   | 零页地址                 |
| 零页X索引寻址    | `LDA $20,X` | 零页X索引寻址             |
| 零页Y索引寻址    | `LDX $20,Y` | 零页Y索引寻址             |
| 绝对寻址         | `LDA $1234` | 完整的16位地址            |
| 绝对X索引寻址    | `LDA $1234,X` | X索引的绝对寻址           |
| 绝对Y索引寻址    | `LDA $1234,Y` | Y索引的绝对寻址           |
| 间接寻址         | `JMP ($1234)` | 基于指针的跳转            |
| 索引间接寻址     | `LDA ($20,X)` | X索引的指针寻址            |
| 间接索引寻址     | `LDA ($20),Y` | Y索引的指针寻址            |
| 相对寻址         | `BEQ label` | 跳转偏移量               |

---

## 6. 指令集概览

### 6.1 加载/存储

* `LDA`, `LDX`, `LDY`
* `STA`, `STX`, `STY`

### 6.2 寄存器传送

* `TAX`, `TAY`, `TXA`, `TYA`, `TSX`, `TXS`

### 6.3 堆栈操作

* `PHA`, `PLA`, `PHP`, `PLP`

### 6.4 算术运算

* `ADC` – 带进位加法
* `SBC` – 带进位减法

### 6.5 逻辑运算

* `AND`, `ORA`, `EOR`

### 6.6 移位和循环移位

* `ASL`, `LSR`, `ROL`, `ROR`

### 6.7 增量/减量

* `INC`, `INX`, `INY`
* `DEC`, `DEX`, `DEY`

### 6.8 比较指令

* `CMP`, `CPX`, `CPY`

### 6.9 跳转指令

* `BEQ`, `BNE`, `BMI`, `BPL`, `BCS`, `BCC`, `BVS`, `BVC`

### 6.10 跳转与子程序调用

* `JMP`, `JSR`, `RTS`, `RTI`

### 6.11 状态标志控制

* `CLC`, `SEC`, `CLI`, `SEI`, `CLV`, `CLD`, `SED`

### 6.12 系统控制

* `BRK`, `NOP`

---

## 7. 周期时序（通用）

* 大多数指令执行时间为 **2–7个周期**
* 可能会因以下情况增加额外周期：

  * 页面边界穿越
  * 被执行的跳转指令

---

## 8. 十进制模式

当 **D标志** 被设置时：

* `ADC` 和 `SBC` 使用 **二进制编码十进制（BCD）运算**
* 仅适用于原始NMOS 6502（在CMOS衍生版本中行为不同）

---

## 9. 已知的硬件特性

* `JMP (addr)` 间接跳转错误：页面边界环绕

  * 示例：`JMP ($10FF)` 会从 `$10FF` 和 `$1000` 读取数据
* 无专用乘法或除法指令
* 堆栈固定在页面 `$01xx`

---

## 10. 变种与衍生版本

| 变种 | 说明                               |
| ---- | ----------------------------------- |
| 6502 | 原始NMOS版本                       |
| 65C02 | CMOS版本，修复了错误，增加了指令     |
| 2A03 | NES变种，十进制模式禁用              |
| 6510 | 增加了I/O端口（康懋达64）           |

---

## 11. 示例代码

```asm
        LDX #$00
loop:   INX
        TXA
        STA $0200,X
        CPX #$10
        BNE loop
        BRK
```

---

## 12. 参考资料

* <https://syncopate.us/books/Synertek6502ProgrammingManual.html>
* <https://en.wikipedia.org/wiki/MOS_Technology_6502>
* <https://web.archive.org/web/20061114024257/http://www.westerndesigncenter.com/wdc/documentation/Programmanual.pdf>
* 摘录自 <https://wilsonminesco.com/6502primer/>
  * <https://wilsonminesco.com/6502primer/LogicFamilies.html>
  * <https://wilsonminesco.com/6502primer/ClkGen.html>
  * <https://wilsonminesco.com/6502primer/RSTreqs.html>
  * <https://wilsonminesco.com/6502primer/displays.html>
  * <https://wilsonminesco.com/6502primer/debug.html>
  * <https://wilsonminesco.com/6502primer/potpourri.html>
```
