---
name: git-commit
description: '使用语义化提交规范执行 Git 提交，具备提交信息分析、智能暂存和信息生成功能。当用户要求提交更改、创建 Git 提交或提及 "/commit" 时使用。支持：(1) 从更改中自动检测类型和范围，(2) 从差异生成语义化提交信息，(3) 支持可选类型/范围/描述覆盖的交互式提交，(4) 智能暂存以实现逻辑分组'
license: MIT
allowed-tools: Bash
---

# 使用语义化提交规范的 Git 提交

## 概述

使用语义化提交规范（Conventional Commits）创建标准化、语义化的 Git 提交。通过分析实际差异来确定合适的类型、范围和提交信息。

## 语义化提交格式

```
<类型>[可选范围]: <描述>

[可选正文]

[可选页脚]
```

## 提交类型

| 类型       | 用途                        |
| ---------- | ---------------------------- |
| `feat`     | 新增功能                     |
| `fix`      | 修复错误                     |
| `docs`     | 仅文档修改                   |
| `style`    | 格式化/样式（不涉及逻辑）    |
| `refactor` | 代码重构（不涉及新增功能或修复） |
| `perf`     | 性能优化                     |
| `test`     | 添加/更新测试                 |
| `build`    | 构建系统/依赖项               |
| `ci`       | CI/配置更改                   |
| `chore`    | 维护/杂项                     |
| `revert`   | 回滚提交                     |

## 破坏性变更

```
# 类型/范围后添加感叹号
feat!: 移除弃用的端点

# BREAKING CHANGE 页脚
feat: 允许配置扩展其他配置

BREAKING CHANGE: `extends` 键的行为已更改
```

## 工作流程

### 1. 分析差异

```bash
# 如果文件已暂存，使用暂存差异
git diff --staged

# 如果未暂存文件，使用工作树差异
git diff

# 也检查状态
git status --porcelain
```

### 2. 暂存文件（如需）

如果未暂存任何文件或希望以不同的方式分组更改：

```bash
# 暂存特定文件
git add path/to/file1 path/to/file2

# 按模式暂存
git add *.test.*
git add src/components/*

# 交互式暂存
git add -p
```

**永远不要提交敏感信息**（如 .env、credentials.json、私钥等）。

### 3. 生成提交信息

分析差异以确定：

- **类型**：这是什么类型的更改？
- **范围**：哪些模块或区域受到影响？
- **描述**：更改的单行摘要（使用现在时，祈使语气，<72 字符）

### 4. 执行提交

```bash
# 单行提交
git commit -m "<类型>[范围]: <描述>"

# 多行提交（含正文/页脚）
git commit -m "$(cat <<'EOF'
<类型>[范围]: <描述>

<可选正文>

<可选页脚>
EOF
)"
```

## 最佳实践

- 每个提交仅包含一个逻辑更改
- 使用现在时：使用 "添加" 而不是 "已添加"
- 使用祈使语气：使用 "修复错误" 而不是 "修复了错误"
- 引用问题：`关闭 #123`，`参考 #456`
- 保持描述在 72 字符以内

## Git 安全协议

- 永远不要修改 git 配置
- 永远不要在没有明确请求的情况下运行破坏性命令（如 --force、hard reset）
- 永远不要跳过钩子（--no-verify），除非用户特别要求
- 永远不要强制推送至 main/master
- 如果提交因钩子失败，修复问题并创建新的提交（不要使用 amend）
