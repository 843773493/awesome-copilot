# Web 安全参考指南

> 来源：[https://developer.mozilla.org/en-US/docs/Web/Security](https://developer.mozilla.org/en-US/docs/Web/Security)

## 概述

Web 安全旨在防止敏感信息（客户数据、密码、银行信息、内部算法）被未经授权的访问，从而避免竞争优势的丧失、服务中断或用户隐私泄露。

## 安全与隐私

- **安全**：防止未经授权的访问（内部和外部数据）以保护私有数据和系统。
- **隐私**：让用户能够通过透明度和同意控制数据的收集、存储和使用。

## 浏览器提供的安全功能

### 同源策略 (SOP) 和跨源资源共享 (CORS)

- **同源策略**：限制来自一个源的文档或脚本与另一个源的资源进行交互。
- **跨源资源共享** (CORS)：一种 HTTP 头机制，允许服务器在需要时批准跨源资源请求。

### HTTP 通信安全

- **HTTPS/TLS**：在传输过程中加密数据，防止第三方拦截。
- **证书透明度 (CT)****：通过公共日志记录保护免受证书错误签发的威胁。

### 安全上下文与功能权限

浏览器限制“强大功能”（通知、网络摄像头、GPU、支付）的使用，要求：

- 安全上下文（通过 `window` 或 `worker` 使用 HTTPS/TLS 传输）。
- 通过权限 API 显式用户授权。
- 用户激活（瞬时激活 —— 需要用户操作，如点击）。

## 高级安全考虑

### 1. 负责任地存储客户端数据

- 限制第三方 Cookie 的使用。
- 为跨站 Cookie 的移除做好准备。
- 实现替代的持久化方法。

### 2. 保护用户身份并管理登录

- 使用具有内置安全功能的可信框架。
- 实施 **多因素认证 (MFA)**。
- 使用专用 API：
  - Web 认证 API
  - 联合凭证管理 (FedCM) API

**登录安全提示：**

- 强制使用强密码。
- 教育用户防范 **钓鱼** 攻击。
- 在登录页面实施 **速率限制**。
- 使用 **验证码** 挑战。
- 使用唯一会话 ID 管理会话。
- 在不活动后自动登出。

### 3. 不要在 URL 查询字符串中包含敏感数据

- 避免使用包含敏感数据的 GET 请求（可通过 Referer 头拦截）。
- 使用 POST 请求代替。
- 防止 CSRF 和重放攻击。

### 4. 强制执行使用策略

- **内容安全策略 (CSP)**：控制图像和脚本的加载来源；缓解 XSS 和数据注入攻击。
- **权限策略**：阻止对特定“强大功能”的访问。

### 5. 保持数据完整性

- **子资源完整性 (SRI)**：对从 CDN 获取的资源进行加密哈希验证。
- **MIME 类型验证**：使用 `X-Content-Type-Options` 头防止 MIME 伪装。
- **Access-Control-Allow-Origin**：管理跨源资源共享。

### 6. 清洗表单输入

- **客户端验证**：使用 HTML 表单验证提供即时反馈。
- **输出编码**：安全地显示用户输入而不将其作为代码执行。
- **服务器端验证**：必不可少；客户端验证容易被绕过。
- **转义特殊字符**：防止可执行代码注入（如 SQL 注入、JavaScript 执行）。

### 7. 防止点击劫持

- **X-Frame-Options**：HTTP 头防止页面在 `<frame>`、`<iframe>`、`<embed>` 或 `<object>` 中渲染。
- **CSP frame-ancestors**：指定可以嵌入页面的有效父源。

## 常见安全攻击

| 攻击类型 | 描述 |
|---|---|
| 点击劫持 | 诱使用户点击隐藏的 UI 元素 |
| 跨站脚本攻击 (XSS) | 向可信网站注入恶意脚本 |
| 跨站请求伪造 (CSRF) | 强迫已认证用户执行未授权操作 |
| 跨站泄露 (XS-Leaks) | 通过旁路通道推断用户信息 |
| SQL 注入 | 通过用户输入插入恶意 SQL |
| 钓鱼 | 模仿可信实体以窃取凭证 |
| 中间人攻击 (MITM) | 截获两方之间的通信 |
| 服务器端请求伪造 (SSRF) | 操纵服务器执行未预期的请求 |
| 子域名劫持 | 利用悬空的 DNS 记录 |
| 供应链攻击 | 破坏第三方依赖项 |
| 原型污染 | 向 JavaScript 对象原型注入属性 |

## 关键 HTTP 安全头

| 头部 | 用途 |
|---|---|
| `Strict-Transport-Security` | 强制使用 HTTPS 访问 |
| `X-Frame-Options` | 防止点击劫持 |
| `X-Content-Type-Options` | 防止 MIME 伪装 |
| `Content-Security-Policy` | 控制资源加载和防止 XSS |
| `Access-Control-Allow-Origin` | 管理 CORS |

## 实践实施指南

1. 内容安全策略 (CSP)
2. 跨源资源共享 (CORS)
3. 子资源完整性 (SRI)
4. 传输层安全 (TLS)
5. 安全 Cookie 配置
6. MIME 类型验证
7. 引用策略
8. 跨源资源策略 (CORP)

## 认证方法

- Passkeys
- 一次性密码 (OTP)
- 联合身份
- 密码认证

## 相关资源

- [网络隐私](https://developer.mozilla.org/en-US/docs/Web/Privacy)
- [OWASP 速查系列](https://cheatsheetseries.owasp.org/)
- [Mozilla 安全博客](https://blog.mozilla.org/security/)
