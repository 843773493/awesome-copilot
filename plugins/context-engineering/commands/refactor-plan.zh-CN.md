---
agent: 'agent'
tools: ['codebase', 'terminalCommand']
description: '制定多文件重构计划，包含适当的执行顺序和回滚步骤'
---

# 重构计划

为本次重构任务创建详细计划。

## 重构目标

{{refactor_description}}

## 操作步骤

1. 搜索代码库以了解当前状态
2. 识别所有受影响的文件及其依赖关系
3. 按安全顺序规划变更（先处理类型，再处理实现，最后处理测试）
4. 在每次变更之间包含验证步骤
5. 考虑到如果出现故障需要回滚的情况

## 输出格式

```markdown
## 重构计划: [标题]

### 当前状态
[对当前工作方式的简要描述]

### 目标状态
[对重构后工作方式的简要描述]

### 受影响的文件
| 文件 | 变更类型 | 依赖项 |
|------|-------------|--------------|
| 路径 | 修改/创建/删除 | 阻塞 X，被 Y 阻塞 |

### 执行计划

#### 第一阶段：类型和接口
- [ ] 步骤 1.1: 在 `file.ts` 中执行 [操作]
- [ ] 验证: [如何检查是否成功]

#### 第二阶段：实现
- [ ] 步骤 2.1: 在 `file.ts` 中执行 [操作]
- [ ] 验证: [如何检查]

#### 第三阶段：测试
- [ ] 步骤 3.1: 更新 `file.test.ts` 中的测试
- [ ] 验证: 运行 `npm test`

#### 第四阶段：清理
- [ ] 删除废弃代码
- [ ] 更新文档

### 回滚计划
如果出现故障：
1. [撤销步骤]
2. [撤销步骤]

### 风险
- [潜在问题及应对措施]
```

是否开始执行第一阶段？
